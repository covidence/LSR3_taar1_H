scale_colour_manual(guide=FALSE, values=c("green4", "firebrick4"))+
xlab("OR 95%CI (OR>1: TAAR1 agonsits worse)")+
theme_bw()
ggplot(data=safety_primary_plot,
aes(y=factor(event_text, level=rev(level_order)), x=exp(point),colour=type_outcome, shape=timepoint, label=n_text))+
geom_text(x=100, colour="black")+
geom_point(aes(size=n), position=position_dodge(width = 0.5))+
geom_errorbar(aes(x=exp(point), xmin=exp(TE.random-1.96*seTE.random),
xmax=exp(TE.random+1.96*seTE.random), colour=type_outcome,shape=timepoint),
width=0, position=position_dodge(width = 0.5))+
geom_vline(xintercept=1, linetype='dashed')+
scale_size_continuous(guide=FALSE)+
facet_grid(factor(MedDRA_group, levels=lever_order_meddra)~., scales = "free", space = "free")+
scale_x_log10() +
ylab("")+
scale_shape_manual(values=c(1,19))+
scale_colour_manual(guide=FALSE, values=c("green4", "firebrick4"))+
xlab("OR 95%CI (OR>1: TAAR1 agonsits worse)")+
theme_bw()
ggplot(data=safety_primary_plot,
aes(y=factor(event_text, level=rev(level_order)), x=exp(point),colour=type_outcome, shape=timepoint, label=n_text))+
geom_text(x=80, colour="black")+
geom_point(aes(size=n), position=position_dodge(width = 0.5))+
geom_errorbar(aes(x=exp(point), xmin=exp(TE.random-1.96*seTE.random),
xmax=exp(TE.random+1.96*seTE.random), colour=type_outcome,shape=timepoint),
width=0, position=position_dodge(width = 0.5))+
geom_vline(xintercept=1, linetype='dashed')+
scale_size_continuous(guide=FALSE)+
facet_grid(factor(MedDRA_group, levels=lever_order_meddra)~., scales = "free", space = "free")+
scale_x_log10() +
ylab("")+
scale_shape_manual(values=c(1,19))+
scale_colour_manual(guide=FALSE, values=c("green4", "firebrick4"))+
xlab("OR 95%CI (OR>1: TAAR1 agonsits worse)")+
theme_bw()
ggplot(data=safety_primary_plot,
aes(y=factor(event_text, level=rev(level_order)), x=exp(point),colour=type_outcome, shape=timepoint))+
geom_text(x=80, label=safety_primary_plot$n_text, colour="black")+
geom_point(aes(size=n), position=position_dodge(width = 0.5))+
geom_errorbar(aes(x=exp(point), xmin=exp(TE.random-1.96*seTE.random),
xmax=exp(TE.random+1.96*seTE.random), colour=type_outcome,shape=timepoint),
width=0, position=position_dodge(width = 0.5))+
geom_vline(xintercept=1, linetype='dashed')+
scale_size_continuous(guide=FALSE)+
facet_grid(factor(MedDRA_group, levels=lever_order_meddra)~., scales = "free", space = "free")+
scale_x_log10() +
ylab("")+
scale_shape_manual(values=c(1,19))+
scale_colour_manual(guide=FALSE, values=c("green4", "firebrick4"))+
xlab("OR 95%CI (OR>1: TAAR1 agonsits worse)")+
theme_bw()
ggplot(data=safety_primary_plot,
aes(y=factor(event_text, level=rev(level_order)), x=exp(point),colour=type_outcome, shape=timepoint))+
geom_text(x=10, label=safety_primary_plot$n_text, colour="black")+
geom_point(aes(size=n), position=position_dodge(width = 0.5))+
geom_errorbar(aes(x=exp(point), xmin=exp(TE.random-1.96*seTE.random),
xmax=exp(TE.random+1.96*seTE.random), colour=type_outcome,shape=timepoint),
width=0, position=position_dodge(width = 0.5))+
geom_vline(xintercept=1, linetype='dashed')+
scale_size_continuous(guide=FALSE)+
facet_grid(factor(MedDRA_group, levels=lever_order_meddra)~., scales = "free", space = "free")+
scale_x_log10() +
ylab("")+
scale_shape_manual(values=c(1,19))+
scale_colour_manual(guide=FALSE, values=c("green4", "firebrick4"))+
xlab("OR 95%CI (OR>1: TAAR1 agonsits worse)")+
theme_bw()
ggplot(data=safety_primary_plot,
aes(y=factor(event_text, level=rev(level_order)), x=exp(point),colour=type_outcome, shape=timepoint))+
geom_text(aes(x=10, label=n_text), colour="black")+
geom_point(aes(size=n), position=position_dodge(width = 0.5))+
geom_errorbar(aes(x=exp(point), xmin=exp(TE.random-1.96*seTE.random),
xmax=exp(TE.random+1.96*seTE.random), colour=type_outcome,shape=timepoint),
width=0, position=position_dodge(width = 0.5))+
geom_vline(xintercept=1, linetype='dashed')+
scale_size_continuous(guide=FALSE)+
facet_grid(factor(MedDRA_group, levels=lever_order_meddra)~., scales = "free", space = "free")+
scale_x_log10() +
ylab("")+
scale_shape_manual(values=c(1,19))+
scale_colour_manual(guide=FALSE, values=c("green4", "firebrick4"))+
xlab("OR 95%CI (OR>1: TAAR1 agonsits worse)")+
theme_bw()
ggplot(data=safety_primary_plot,
aes(y=factor(event_text, level=rev(level_order)), x=exp(point),colour=type_outcome, shape=timepoint))+
geom_text(aes(x=100, label=n_text), colour="black")+
geom_point(aes(size=n), position=position_dodge(width = 0.5))+
geom_errorbar(aes(x=exp(point), xmin=exp(TE.random-1.96*seTE.random),
xmax=exp(TE.random+1.96*seTE.random), colour=type_outcome,shape=timepoint),
width=0, position=position_dodge(width = 0.5))+
geom_vline(xintercept=1, linetype='dashed')+
scale_size_continuous(guide=FALSE)+
facet_grid(factor(MedDRA_group, levels=lever_order_meddra)~., scales = "free", space = "free")+
scale_x_log10() +
ylab("")+
scale_shape_manual(values=c(1,19))+
scale_colour_manual(guide=FALSE, values=c("green4", "firebrick4"))+
xlab("OR 95%CI (OR>1: TAAR1 agonsits worse)")+
theme_bw()
ggplot(data=safety_primary_plot,
aes(y=factor(event_text, level=rev(level_order)), x=exp(point),colour=type_outcome, shape=timepoint))+
geom_text(aes(x=0.1, label=n_text), colour="black")+
geom_point(aes(size=n), position=position_dodge(width = 0.5))+
geom_errorbar(aes(x=exp(point), xmin=exp(TE.random-1.96*seTE.random),
xmax=exp(TE.random+1.96*seTE.random), colour=type_outcome,shape=timepoint),
width=0, position=position_dodge(width = 0.5))+
geom_vline(xintercept=1, linetype='dashed')+
scale_size_continuous(guide=FALSE)+
facet_grid(factor(MedDRA_group, levels=lever_order_meddra)~., scales = "free", space = "free")+
scale_x_log10() +
ylab("")+
scale_shape_manual(values=c(1,19))+
scale_colour_manual(guide=FALSE, values=c("green4", "firebrick4"))+
xlab("OR 95%CI (OR>1: TAAR1 agonsits worse)")+
theme_bw()
ggplot(data=safety_primary_plot,
aes(y=factor(event_text, level=rev(level_order)), x=exp(point),colour=type_outcome, shape=timepoint))+
geom_text(aes(x=0.03, label=n_text), colour="black")+
geom_point(aes(size=n), position=position_dodge(width = 0.5))+
geom_errorbar(aes(x=exp(point), xmin=exp(TE.random-1.96*seTE.random),
xmax=exp(TE.random+1.96*seTE.random), colour=type_outcome,shape=timepoint),
width=0, position=position_dodge(width = 0.5))+
geom_vline(xintercept=1, linetype='dashed')+
scale_size_continuous(guide=FALSE)+
facet_grid(factor(MedDRA_group, levels=lever_order_meddra)~., scales = "free", space = "free")+
scale_x_log10() +
ylab("")+
scale_shape_manual(values=c(1,19))+
scale_colour_manual(guide=FALSE, values=c("green4", "firebrick4"))+
xlab("OR 95%CI (OR>1: TAAR1 agonsits worse)")+
theme_bw()
ggplot(data=safety_primary_plot,
aes(y=factor(event_text, level=rev(level_order)), x=exp(point),colour=type_outcome, shape=timepoint))+
geom_text(aes(x=0.03, label=n_text), colour="black" , position=position_dodge(width = 0.5))+
geom_point(aes(size=n), position=position_dodge(width = 0.5))+
geom_errorbar(aes(x=exp(point), xmin=exp(TE.random-1.96*seTE.random),
xmax=exp(TE.random+1.96*seTE.random), colour=type_outcome,shape=timepoint),
width=0, position=position_dodge(width = 0.5))+
geom_vline(xintercept=1, linetype='dashed')+
scale_size_continuous(guide=FALSE)+
facet_grid(factor(MedDRA_group, levels=lever_order_meddra)~., scales = "free", space = "free")+
scale_x_log10() +
ylab("")+
scale_shape_manual(values=c(1,19))+
scale_colour_manual(guide=FALSE, values=c("green4", "firebrick4"))+
xlab("OR 95%CI (OR>1: TAAR1 agonsits worse)")+
theme_bw()
ggplot(data=safety_primary_plot,
aes(y=factor(event_text, level=rev(level_order)), x=exp(point),colour=type_outcome, shape=timepoint))+
geom_text(aes(x=0.03, label=n_text), colour="black" , position=position_dodge(width = 0.7))+
geom_point(aes(size=n), position=position_dodge(width = 0.5))+
geom_errorbar(aes(x=exp(point), xmin=exp(TE.random-1.96*seTE.random),
xmax=exp(TE.random+1.96*seTE.random), colour=type_outcome,shape=timepoint),
width=0, position=position_dodge(width = 0.5))+
geom_vline(xintercept=1, linetype='dashed')+
scale_size_continuous(guide=FALSE)+
facet_grid(factor(MedDRA_group, levels=lever_order_meddra)~., scales = "free", space = "free")+
scale_x_log10() +
ylab("")+
scale_shape_manual(values=c(1,19))+
scale_colour_manual(guide=FALSE, values=c("green4", "firebrick4"))+
xlab("OR 95%CI (OR>1: TAAR1 agonsits worse)")+
theme_bw()
ggplot(data=safety_primary_plot,
aes(y=factor(event_text, level=rev(level_order)), x=exp(point),colour=type_outcome, shape=timepoint))+
geom_text(aes(x=0.03, label=n_text), colour="black" , position=position_dodge(width = 0.9))+
geom_point(aes(size=n), position=position_dodge(width = 0.5))+
geom_errorbar(aes(x=exp(point), xmin=exp(TE.random-1.96*seTE.random),
xmax=exp(TE.random+1.96*seTE.random), colour=type_outcome,shape=timepoint),
width=0, position=position_dodge(width = 0.5))+
geom_vline(xintercept=1, linetype='dashed')+
scale_size_continuous(guide=FALSE)+
facet_grid(factor(MedDRA_group, levels=lever_order_meddra)~., scales = "free", space = "free")+
scale_x_log10() +
ylab("")+
scale_shape_manual(values=c(1,19))+
scale_colour_manual(guide=FALSE, values=c("green4", "firebrick4"))+
xlab("OR 95%CI (OR>1: TAAR1 agonsits worse)")+
theme_bw()
ggplot(data=efficacy_primary,
aes(y=factor(event_text, level=rev(level_outcomes)), x=point))+
geom_text(aes(x=-0.8, label=n_text), colour="black" , position=position_dodge(width = 0.9))+
geom_point(aes(size=n), position=position_dodge(width = 0.5), colour="royalblue4")+ #Size proportional to the number of participants
coord_cartesian(xlim=c(-0.8,0.8))+
geom_errorbar(aes(x=point, xmin=lb,
xmax=ub),
width=0, position=position_dodge(width = 0.5), colour="royalblue4")+
scale_size_continuous(guide=FALSE)+
geom_vline(xintercept=0, linetype='dashed')+
facet_grid(~factor(population, levels=level_population))+
ylab("")+
xlab("SMD 95%CI (SMD>0: TAAR1 agonist better)")+
theme_bw()
ggplot(data=efficacy_primary,
aes(y=factor(event_text, level=rev(level_outcomes)), x=point))+
geom_text(aes(x=-0.7, label=n_text), colour="black" , position=position_dodge(width = 0.9))+
geom_point(aes(size=n), position=position_dodge(width = 0.5), colour="royalblue4")+ #Size proportional to the number of participants
coord_cartesian(xlim=c(-0.8,0.8))+
geom_errorbar(aes(x=point, xmin=lb,
xmax=ub),
width=0, position=position_dodge(width = 0.5), colour="royalblue4")+
scale_size_continuous(guide=FALSE)+
geom_vline(xintercept=0, linetype='dashed')+
facet_grid(~factor(population, levels=level_population))+
ylab("")+
xlab("SMD 95%CI (SMD>0: TAAR1 agonist better)")+
theme_bw()
ggplot(data=efficacy_primary,
aes(y=factor(event_text, level=rev(level_outcomes)), x=point))+
geom_text(aes(x=-0.6, label=n_text), colour="black" , position=position_dodge(width = 0.9))+
geom_point(aes(size=n), position=position_dodge(width = 0.5), colour="royalblue4")+ #Size proportional to the number of participants
coord_cartesian(xlim=c(-0.8,0.8))+
geom_errorbar(aes(x=point, xmin=lb,
xmax=ub),
width=0, position=position_dodge(width = 0.5), colour="royalblue4")+
scale_size_continuous(guide=FALSE)+
geom_vline(xintercept=0, linetype='dashed')+
facet_grid(~factor(population, levels=level_population))+
ylab("")+
xlab("SMD 95%CI (SMD>0: TAAR1 agonist better)")+
theme_bw()
ggplot(data=efficacy_primary,
aes(y=factor(event_text, level=rev(level_outcomes)), x=point))+
geom_text(aes(x=-0.65, label=n_text), colour="black" , position=position_dodge(width = 0.9))+
geom_point(aes(size=n), position=position_dodge(width = 0.5), colour="royalblue4")+ #Size proportional to the number of participants
coord_cartesian(xlim=c(-0.8,0.8))+
geom_errorbar(aes(x=point, xmin=lb,
xmax=ub),
width=0, position=position_dodge(width = 0.5), colour="royalblue4")+
scale_size_continuous(guide=FALSE)+
geom_vline(xintercept=0, linetype='dashed')+
facet_grid(~factor(population, levels=level_population))+
ylab("")+
xlab("SMD 95%CI (SMD>0: TAAR1 agonist better)")+
theme_bw()
ggplot(data=efficacy_primary,
aes(y=factor(event_text, level=rev(level_outcomes)), x=point))+
geom_text(aes(x=0.5, label=n_text), colour="black" , position=position_dodge(width = 0.9))+
geom_point(aes(size=n), position=position_dodge(width = 0.5), colour="royalblue4")+ #Size proportional to the number of participants
coord_cartesian(xlim=c(-0.8,0.8))+
geom_errorbar(aes(x=point, xmin=lb,
xmax=ub),
width=0, position=position_dodge(width = 0.5), colour="royalblue4")+
scale_size_continuous(guide=FALSE)+
geom_vline(xintercept=0, linetype='dashed')+
facet_grid(~factor(population, levels=level_population))+
ylab("")+
xlab("SMD 95%CI (SMD>0: TAAR1 agonist better)")+
theme_bw()
ggplot(data=efficacy_primary,
aes(y=factor(event_text, level=rev(level_outcomes)), x=point))+
geom_text(aes(x=0.65, label=n_text), colour="black" , position=position_dodge(width = 0.9))+
geom_point(aes(size=n), position=position_dodge(width = 0.5), colour="royalblue4")+ #Size proportional to the number of participants
coord_cartesian(xlim=c(-0.8,0.8))+
geom_errorbar(aes(x=point, xmin=lb,
xmax=ub),
width=0, position=position_dodge(width = 0.5), colour="royalblue4")+
scale_size_continuous(guide=FALSE)+
geom_vline(xintercept=0, linetype='dashed')+
facet_grid(~factor(population, levels=level_population))+
ylab("")+
xlab("SMD 95%CI (SMD>0: TAAR1 agonist better)")+
theme_bw()
efficacy_primary_2<-meta_outcome %>% left_join(outcome_categories) %>%
filter(outcome=="cognition" | outcome=="depression" | outcome=="negative" | outcome=="overall" | outcome=="positive") %>% #efficacy outcome
filter(!is.na(TE.random)) %>% filter(!is.na(event_text)) %>%
mutate(point=TE.random,
lb=TE.random-1.96*seTE.random,
ub=TE.random+1.96*seTE.random) %>%
unique() %>%
filter(comparison=="taar1_vs_antipsychotic") %>%
mutate(n_text=paste0("N=", k,", n=",n))
ggplot(data=efficacy_primary_2,
aes(y=factor(event_text, level=rev(level_outcomes)), x=point))+
geom_text(aes(x=0.65, label=n_text), colour="black" , position=position_dodge(width = 0.9))+
geom_point(size=3.4,position=position_dodge(width = 0.5), colour="royalblue4")+ #Size proportional to the number of participants
coord_cartesian(xlim=c(-0.8,0.8))+
geom_errorbar(aes(x=point, xmin=lb,
xmax=ub),
width=0, position=position_dodge(width = 0.5), colour="royalblue4")+
scale_size_continuous(guide=FALSE)+
geom_vline(xintercept=0, linetype='dashed')+
facet_grid(~factor(population, levels=level_population))+
ylab("")+
xlab("SMD 95%CI (SMD>0: TAAR1 agonists better)")+
theme_bw()
safety_primary_2<-meta_outcome %>% left_join(ae_categories) %>%  #I need to change a bit
mutate(event_text=ifelse(outcome=="death", "Mortality",
ifelse(outcome=="serious", "Serious event",
ifelse(outcome=="dropout_any", "Dropouts any reason",
ifelse(outcome=="dropout_ae", "Dropouts adverse event", event_text)))),
MedDRA_group=ifelse(outcome=="death" | outcome=="serious", "serious",
ifelse(outcome=="dropout_any" | outcome=="dropout_ae", "dropouts", MedDRA_group))) %>%
filter(!is.na(TE.random)) %>% filter(!is.na(event_text)) %>%
mutate(point=TE.random,
lb=TE.random-1.96*seTE.random,
ub=TE.random+1.96*seTE.random) %>% unique() %>%
filter(comparison=="taar1_vs_antipsychotic") %>%
mutate(n_text=paste0("N=", k,", n=",n))
safety_primary_plot_2 <-safety_primary_2
safety_primary_plot_2$event_text <- factor(safety_primary_plot_2$event_tex, levels=unique(safety_primary_plot_2$event_tex))
level_order_2<- sort(unique(safety_primary_plot_2$event_text))
lever_order_meddra<-c("dropouts", "any", "serious", "autonomic", "endocrinic", "neuromuscular", "neuropsychiatric")
safety_primary_plot_2<-safety_primary_plot_2 %>% mutate(type_outcome=ifelse(outcome=="dropout_any" | outcome=="dropout_ae", "dropout", "side"))
ggplot(data=safety_primary_plot_2,
aes(y=factor(event_text, level=rev(level_order_2)), x=exp(point),colour=type_outcome, shape=timepoint))+
geom_text(aes(x=0.03, label=n_text), colour="black" , position=position_dodge(width = 0.9))+
geom_point(aes(size=n), position=position_dodge(width = 0.5))+
geom_errorbar(aes(x=exp(point), xmin=exp(TE.random-1.96*seTE.random),
xmax=exp(TE.random+1.96*seTE.random), colour=type_outcome,shape=timepoint),
width=0, position=position_dodge(width = 0.5))+
geom_vline(xintercept=1, linetype='dashed')+
scale_size_continuous(guide=FALSE, range=c(1,3))+
facet_grid(factor(MedDRA_group, levels=lever_order_meddra)~., scales = "free", space = "free")+
scale_x_log10() +
ylab("")+
scale_shape_manual(values=c(1,19))+
scale_colour_manual(guide=FALSE, values=c("green4", "firebrick4"))+
xlab("OR 95%CI (OR>1: TAAR1 agonsits worse)")+
theme_bw()
ggplot(data=safety_primary_plot_2,
aes(y=factor(event_text, level=rev(level_order_2)), x=exp(point),colour=type_outcome, shape=timepoint))+
geom_text(aes(x=0.03, label=n_text), colour="black" , position=position_dodge(width = 0.9))+
geom_point(aes(size=n), position=position_dodge(width = 0.5))+
geom_errorbar(aes(x=exp(point), xmin=exp(TE.random-1.96*seTE.random),
xmax=exp(TE.random+1.96*seTE.random), colour=type_outcome,shape=timepoint),
width=0, position=position_dodge(width = 0.5))+
geom_vline(xintercept=1, linetype='dashed')+
scale_size_continuous(guide=FALSE, range=c(1,3))+
facet_grid(factor(MedDRA_group, levels=lever_order_meddra)~., scales = "free", space = "free")+
scale_x_log10(xlim=c(0.01, 100)) +
ylab("")+
scale_shape_manual(values=c(1,19))+
scale_colour_manual(guide=FALSE, values=c("green4", "firebrick4"))+
xlab("OR 95%CI (OR>1: TAAR1 agonsits worse)")+
theme_bw()
scale_x_log10()
?scale_x_log10
ggplot(data=safety_primary_plot_2,
aes(y=factor(event_text, level=rev(level_order_2)), x=exp(point),colour=type_outcome, shape=timepoint))+
geom_text(aes(x=0.03, label=n_text), colour="black" , position=position_dodge(width = 0.9))+
geom_point(aes(size=n), position=position_dodge(width = 0.5))+
geom_errorbar(aes(x=exp(point), xmin=exp(TE.random-1.96*seTE.random),
xmax=exp(TE.random+1.96*seTE.random), colour=type_outcome,shape=timepoint),
width=0, position=position_dodge(width = 0.5))+
geom_vline(xintercept=1, linetype='dashed')+
scale_size_continuous(guide=FALSE, range=c(1,3))+
facet_grid(factor(MedDRA_group, levels=lever_order_meddra)~., scales = "free", space = "free")+
scale_x_log10(limits=c(0.01, 100)) +
ylab("")+
scale_shape_manual(values=c(1,19))+
scale_colour_manual(guide=FALSE, values=c("green4", "firebrick4"))+
xlab("OR 95%CI (OR>1: TAAR1 agonsits worse)")+
theme_bw()
ggplot(data=safety_primary_plot_2,
aes(y=factor(event_text, level=rev(level_order_2)), x=exp(point),colour=type_outcome, shape=timepoint))+
geom_text(aes(x=0.01, label=n_text), colour="black" , position=position_dodge(width = 0.9))+
geom_point(aes(size=n), position=position_dodge(width = 0.5))+
geom_errorbar(aes(x=exp(point), xmin=exp(TE.random-1.96*seTE.random),
xmax=exp(TE.random+1.96*seTE.random), colour=type_outcome,shape=timepoint),
width=0, position=position_dodge(width = 0.5))+
geom_vline(xintercept=1, linetype='dashed')+
scale_size_continuous(guide=FALSE, range=c(1,3))+
facet_grid(factor(MedDRA_group, levels=lever_order_meddra)~., scales = "free", space = "free")+
scale_x_log10() +
ylab("")+
scale_shape_manual(values=c(1,19))+
scale_colour_manual(guide=FALSE, values=c("green4", "firebrick4"))+
xlab("OR 95%CI (OR>1: TAAR1 agonsits worse)")+
theme_bw()
### libraries
library(meta)
library(tidyverse)
library(tibble)
library(stringr)
library(readxl)
library(grid)
library(dplyr)
library(knitr)
library(kableExtra)
library(devtools)
#library(metafor)
library(robvis) #Need to install from devtools::install_github("mcguinlu/robvis")
library(PRISMA2020)
library(grateful)
#devtools::install_github("haozhu233/kableExtra") I need to remove this, otherwise the R markdown didnt work
#Empty the enviroment
rm(list=ls())
# Set option defaults
knitr::opts_chunk$set(echo = T, warning = F, message = F)
#Data cleaning routines
source("data/clean_data.R")
#Data analysis routines and functions
source("util/analysis.R")
# Loading
studies<-read_xlsx('data/studies_2024-01-22_LSR3_H.xlsx', na = "NA") #Descriptive data set with included studies
data <- read_xlsx('data/data_2024-01-22_LSR3_H.xlsx') #Clean data with the RCTs with available data
data_doses<-read_xlsx("data/data_doses_2024-01-22_LSR3_H.xlsx") #Effect sizes for the individual doses of TAAR1 (for a descriptive figure)
ae_categories<-read_xlsx("data/ae_categories.xlsx") #Supporting file with the names of adverse events for the summary plot for the side-effects
#prisma data
prisma<-read.csv("data/LSR3_H_PRISMA_2024.01.23.csv") #csv file for the prisma2020
prisma<-PRISMA_data(prisma)
#risk of bias data
rob<-read_xlsx("data/rob_secondary_2024.01.24.xlsx")
#results matrix table
results_matrix<-read_xlsx("data/reporting_bias table_2024.01.26.xlsx")
#SoE tables
soe_sch_ta1_pl_eff<-read_xlsx("data/soe_tables_2024.01.30.xlsx", sheet = 1)
soe_sch_ta1_apd_eff<-read_xlsx("data/soe_tables_2024.01.30.xlsx", sheet = 2)
soe_pd_ta1_pl_eff<-read_xlsx("data/soe_tables_2024.01.30.xlsx", sheet = 3)
soe_all_ta1_pl_saf<-read_xlsx("data/soe_tables_2024.01.30.xlsx", sheet = 4)
soe_all_ta1_apd_saf<-read_xlsx("data/soe_tables_2024.01.30.xlsx", sheet = 5)
soe_mechanistic<-read_xlsx("data/soe_tables_2024.01.30.xlsx", sheet = 6)
#Round off results to two digits
options(scipen=1, digits=2)
forest(meta_comp_overall_sch,
col.diamond = "royalblue4",
col.square =   "royalblue1",
rightcols = c("effect", "ci","Overall_overall"),
rightlabs = c("SMD", "95%-CI", "Risk of bias"),
xlim=c(-0.8,0.8),
label.e = unique(meta_comp_overall_sch$data$treat1_new),
label.c=unique(meta_comp_overall_sch$data$treat2_new),
subgroup.hetstat = FALSE, overall.hetstat =TRUE, test.subgroup.random = FALSE,test.subgroup.fixed = FALSE,
overall = TRUE, prediction.subgroup = FALSE,
subgroup = FALSE, fixed=TRUE,
label.left = "Placebo better", label.right="TAAR1 better")
ae_categories<-ae_categories %>%
select(event_text, MedDRA_an, MedDRA_group) %>%
rename(outcome=MedDRA_an)
safety_primary<-meta_outcome %>% left_join(ae_categories) %>%  #I need to change a bit
mutate(event_text=ifelse(outcome=="death", "Mortality",
ifelse(outcome=="serious", "Serious event",
ifelse(outcome=="dropout_any", "Dropouts any reason",
ifelse(outcome=="dropout_ae", "Dropouts adverse event", event_text)))),
MedDRA_group=ifelse(outcome=="death" | outcome=="serious", "serious",
ifelse(outcome=="dropout_any" | outcome=="dropout_ae", "dropouts", MedDRA_group))) %>%
filter(!is.na(TE.random)) %>% filter(!is.na(event_text)) %>%
mutate(point=TE.random,
lb=TE.random-1.96*seTE.random,
ub=TE.random+1.96*seTE.random) %>% unique() %>%
filter(comparison=="taar1_vs_placebo") %>%
mutate(n_text=paste0("N=", k,", n=",n))
safety_primary_plot <-safety_primary
safety_primary_plot$event_text <- factor(safety_primary_plot$event_tex, levels=unique(safety_primary_plot$event_tex))
level_order<- sort(unique(safety_primary_plot$event_text))
lever_order_meddra<-c("dropouts", "any", "serious", "autonomic", "endocrinic", "neuromuscular", "neuropsychiatric")
safety_primary_plot$event_text <- factor(safety_primary_plot$event_tex, levels=unique(safety_primary_plot$event_tex))
level_order<- sort(unique(safety_primary_plot$event_text))
lever_order_meddra<-c("dropouts", "any", "serious", "autonomic", "endocrinic", "neuromuscular", "neuropsychiatric")
safety_primary_plot<-safety_primary_plot %>% mutate(type_outcome=ifelse(outcome=="dropout_any" | outcome=="dropout_ae", "dropout", "side"))
ggplot(data=safety_primary_plot,
aes(y=factor(event_text, level=rev(level_order)), x=exp(point),colour=type_outcome, shape=timepoint))+
geom_text(aes(x=0.03, label=n_text), colour="black" , position=position_dodge(width = 0.9))+
geom_point(aes(size=n), position=position_dodge(width = 0.5))+
geom_errorbar(aes(x=exp(point), xmin=exp(TE.random-1.96*seTE.random),
xmax=exp(TE.random+1.96*seTE.random), colour=type_outcome,shape=timepoint),
width=0, position=position_dodge(width = 0.5))+
geom_vline(xintercept=1, linetype='dashed')+
scale_size_continuous(guide=FALSE)+
facet_grid(factor(MedDRA_group, levels=lever_order_meddra)~., scales = "free", space = "free")+
scale_x_log10() +
ylab("")+
scale_shape_manual(values=c(1,19))+
scale_colour_manual(guide=FALSE, values=c("green4", "firebrick4"))+
xlab("OR 95%CI (OR>1: TAAR1 agonsits worse)")+
theme_bw()
### libraries
library(meta)
library(tidyverse)
library(tibble)
library(stringr)
library(readxl)
library(grid)
library(dplyr)
library(knitr)
library(kableExtra)
library(devtools)
#library(metafor)
library(robvis) #Need to install from devtools::install_github("mcguinlu/robvis")
library(PRISMA2020)
library(grateful)
#devtools::install_github("haozhu233/kableExtra") I need to remove this, otherwise the R markdown didnt work
#Empty the enviroment
rm(list=ls())
# Set option defaults
knitr::opts_chunk$set(echo = T, warning = F, message = F)
#Data cleaning routines
source("data/clean_data.R")
#Data analysis routines and functions
source("util/analysis.R")
# Loading
studies<-read_xlsx('data/studies_2024-01-22_LSR3_H.xlsx', na = "NA") #Descriptive data set with included studies
data <- read_xlsx('data/data_2024-01-22_LSR3_H.xlsx') #Clean data with the RCTs with available data
data_doses<-read_xlsx("data/data_doses_2024-01-22_LSR3_H.xlsx") #Effect sizes for the individual doses of TAAR1 (for a descriptive figure)
ae_categories<-read_xlsx("data/ae_categories.xlsx") #Supporting file with the names of adverse events for the summary plot for the side-effects
#prisma data
prisma<-read.csv("data/LSR3_H_PRISMA_2024.01.23.csv") #csv file for the prisma2020
prisma<-PRISMA_data(prisma)
#risk of bias data
rob<-read_xlsx("data/rob_secondary_2024.01.24.xlsx")
#results matrix table
results_matrix<-read_xlsx("data/reporting_bias table_2024.01.26.xlsx")
#SoE tables
soe_sch_ta1_pl_eff<-read_xlsx("data/soe_tables_2024.01.30.xlsx", sheet = 1)
soe_sch_ta1_apd_eff<-read_xlsx("data/soe_tables_2024.01.30.xlsx", sheet = 2)
soe_pd_ta1_pl_eff<-read_xlsx("data/soe_tables_2024.01.30.xlsx", sheet = 3)
soe_all_ta1_pl_saf<-read_xlsx("data/soe_tables_2024.01.30.xlsx", sheet = 4)
soe_all_ta1_apd_saf<-read_xlsx("data/soe_tables_2024.01.30.xlsx", sheet = 5)
soe_mechanistic<-read_xlsx("data/soe_tables_2024.01.30.xlsx", sheet = 6)
#Round off results to two digits
options(scipen=1, digits=2)
