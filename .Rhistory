library(meta)
library(tidyverse)
library(tibble)
library(stringr)
library(readxl)
library(grid)
library(dplyr)
library(knitr)
library(kableExtra)
library(meta)
library(devtools)
library(metafor)
library(robvis)
devtools::install_github("haozhu233/kableExtra")
#Empty the enviroment
rm(list=ls())
#Functions needed to run this script
source("util/util.R") #Spiros: I had problems to run this function as a separate file in util.R so i included it within the analysis.R below, theni could run the markdown.
#Data cleaning routines
source("data/clean_data.R")
#Data analysis routines
source("util/analysis.R")
# Loading
studies<-read_xlsx('data/studies_2023-11-24_LSR3_H.xlsx', na = "NA") #Descriptive data set with all included studies (RCT and not)
data <- read_xlsx('data/data_2023-11-24_LSR3_H.xlsx') #Clean data with the RCTs with available data
data_doses<-read_xlsx("data/data_doses_2023-11-24_LSR3_H.xlsx") #Effect sizes for the individual doses of TAAR1 (for descriptive figure)
ae_categories<-read_xlsx("data/ae_categories.xlsx") #Supporting file with the names of adverse events for the summary plot for the side-effects
#Round off results to two digits
options(scipen=1, digits=2)
knitr::kable(studies[, 1:14])
knitr::kable(studies[, 1:14])
rob_traffic_light(data=master[!is.na(master$D1), c(2, 26:31)], tool = "ROB2",  psize = 12)
forest(`meta_comp_taar1_vs_placebo_3-13 weeks_overall`,
rightcols = c("effect", "ci", "rob"),
rightlabs = c("SMD", "95%-CI", "Risk of bias"),  xlim=c(-0.8,0.8),
label.e = unique(`meta_comp_taar1_vs_placebo_3-13 weeks_overall`$data$treat1_new), label.c=unique(`meta_comp_taar1_vs_placebo_3-13 weeks_overall`$data$treat2_new),
subgroup.hetstat = TRUE, overall.hetstat =FALSE, test.subgroup.random = FALSE,
overall = FALSE, prediction.subgroup = FALSE,
subgroup = TRUE,
label.left = "Placebo better", label.right="TAAR1 better")
forest_presentation(`meta_comp_taar1_vs_placebo_3-13 weeks_positive`, "efficacy")
forest_presentation(`meta_comp_taar1_vs_placebo_3-13 weeks_negative`, "efficacy")
forest_presentation(`meta_comp_taar1_vs_placebo_3-13 weeks_depression`, "efficacy")
forest_presentation(`meta_comp_taar1_vs_placebo_3-13 weeks_cognition`, "efficacy")
forest_presentation(`meta_comp_taar1_vs_placebo_3-13 weeks_response`, "efficacy")
forest_presentation(`meta_comp_taar1_vs_placebo_1 day-2 weeks_dropout_any`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_3-13 weeks_dropout_any`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_1 day-2 weeks_dropout_ae`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_3-13 weeks_dropout_ae`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_1 day-2 weeks_serious`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_3-13 weeks_serious`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_1 day-2 weeks_death`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_3-13 weeks_death`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_1 day-2 weeks_adverse_event`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_3-13 weeks_adverse_event`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_1 day-2 weeks_anticholinertgic_symptom`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_3-13 weeks_hypotension`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_1 day-2 weeks_dizziness`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_3-13 weeks_dizziness`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_1 day-2 weeks_nausea_vomitting`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_3-13 weeks_nausea_vomitting`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_3-13 weeks_nausea_vomitting`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_1 day-2 weeks_qtc_prolongation`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_3-13 weeks_qtc_prolongation`, "safety")
forest(metagen(data=master[master$study_name=="Tsukada (2023)" & master$drug_name=="ulotaront",],
TE=qtc_md_point, seTE=qtc_md_se, sm="MD", studlab = study_name),
prediction = FALSE,
label.e = unique(meta_comp$data$treat1_new), label.c=unique(meta_comp$data$treat2_new),
label.left = "TAAR1 better",
label.right="TAAR1 worse")
forest_presentation(`meta_comp_taar1_vs_placebo_3-13 weeks_weight_increased`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_3-13 weeks_weight`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_1 day-2 weeks_hyperprolactinemia`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_3-13 weeks_prolactin`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_3-13 weeks_akathisia`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_3-13 weeks_eps_symptoms`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_1 day-2 weeks_anxiety`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_3-13 weeks_anxiety`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_3-13 weeks_agitation`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_1 day-2 weeks_headache`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_3-13 weeks_headache`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_1 day-2 weeks_sedation`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_3-13 weeks_headache`, "safety")
forest_presentation(`meta_comp_taar1_vs_placebo_3-13 weeks_insomnia`, "safety")
ae_categories<-ae_categories %>% select(event_text, MedDRA_an, MedDRA_group) %>%
rename(outcome=MedDRA_an)
safety_primary<-meta_outcome %>% left_join(ae_categories) %>%
mutate(event_text=ifelse(outcome=="death", "Mortality",
ifelse(outcome=="serious", "Serious event",
ifelse(outcome=="dropout_any", "Dropouts any reason",
ifelse(outcome=="dropout_ae", "Dropouts adverse event", event_text)))),
MedDRA_group=ifelse(outcome=="death" | outcome=="serious", "serious",
ifelse(outcome=="dropout_any" | outcome=="dropout_ae", "dropouts", MedDRA_group))) %>%
filter(!is.na(TE)) %>% filter(!is.na(event_text)) %>%
mutate(point=TE,
lb=TE-1.96*seTE,
ub=TE+1.96*seTE) %>% unique() %>%
filter(comparison=="taar1_vs_placebo")
safety_primary_timepoint<-safety_primary %>% filter(timepoint=="3-13 weeks")
safety_primary_plot <-safety_primary %>% filter(event_text %in% safety_primary_timepoint$event_text)
safety_primary_plot$event_text <- factor(safety_primary_plot$event_tex, levels=unique(safety_primary_plot$event_tex))
level_order<- sort(unique(safety_primary_plot$event_text))
lever_order_meddra<-c("dropouts", "any", "serious", "autonomic", "endocrinic", "neuromuscular", "neuropsychiatric")
safety_primary_plot$event_text <- factor(safety_primary_plot$event_tex, levels=unique(safety_primary_plot$event_tex))
level_order<- sort(unique(safety_primary_plot$event_text))
lever_order_meddra<-c("dropouts", "any", "serious", "autonomic", "endocrinic", "neuromuscular", "neuropsychiatric")
ggplot(data=safety_primary_plot,
aes(y=factor(event_text, level=rev(level_order)), x=exp(point), colour=timepoint))+
geom_point(position=position_dodge(width = 0.5))+
geom_errorbar(aes(x=exp(point), xmin=exp(TE-1.96*seTE),
xmax=exp(TE+1.96*seTE), colour=timepoint),
width=0, position=position_dodge(width = 0.5))+
geom_vline(xintercept=1, linetype='dashed')+
facet_grid(factor(MedDRA_group, levels=lever_order_meddra)~., scales = "free", space = "free")+
scale_x_log10() +
ylab("")+
xlab("OR 95%CI")+
theme_bw()
forest(`meta_comp_taar1_vs_antipsychotic_3-13 weeks_overall`,
rightcols = c("effect", "ci", "rob"),
rightlabs = c("SMD", "95%-CI", "Risk of bias"),  xlim=c(-0.8,0.8),
label.e = unique(`meta_comp_taar1_vs_antipsychotic_3-13 weeks_overall`$data$treat1_new), label.c=unique(`meta_comp_taar1_vs_antipsychotic_3-13 weeks_overall`$data$treat2_new),
subgroup.hetstat = TRUE, overall.hetstat =FALSE, test.subgroup.random = FALSE,
overall = FALSE, prediction.subgroup = FALSE,
subgroup = TRUE,
label.left = "Antipsychotic better", label.right="TAAR1 better")
forest_presentation(`meta_comp_taar1_vs_antipsychotic_3-13 weeks_positive`, "efficacy")
forest_presentation(`meta_comp_taar1_vs_antipsychotic_3-13 weeks_negative`, "efficacy")
forest_presentation(`meta_comp_taar1_vs_antipsychotic_3-13 weeks_depression`, "efficacy")
forest_presentation(`meta_comp_taar1_vs_antipsychotic_3-13 weeks_response`, "efficacy")
forest_presentation(`meta_comp_taar1_vs_antipsychotic_1 day-2 weeks_dropout_any`, "safety")
forest_presentation(`meta_comp_taar1_vs_antipsychotic_3-13 weeks_dropout_any`, "safety")
forest_presentation(`meta_comp_taar1_vs_antipsychotic_1 day-2 weeks_dropout_ae`, "safety")
forest_presentation(`meta_comp_taar1_vs_antipsychotic_3-13 weeks_dropout_ae`, "safety")
forest_presentation(`meta_comp_taar1_vs_antipsychotic_1 day-2 weeks_serious`, "safety")
forest_presentation(`meta_comp_taar1_vs_antipsychotic_3-13 weeks_serious`, "safety")
forest_presentation(`meta_comp_taar1_vs_antipsychotic_1 day-2 weeks_death`, "safety")
forest_presentation(`meta_comp_taar1_vs_antipsychotic_3-13 weeks_death`, "safety")
forest_presentation(`meta_comp_taar1_vs_antipsychotic_1 day-2 weeks_adverse_event`, "safety")
forest_presentation(`meta_comp_taar1_vs_antipsychotic_3-13 weeks_adverse_event`, "safety")
forest_presentation(`meta_comp_taar1_vs_antipsychotic_1 day-2 weeks_anticholinertgic_symptom`, "safety")
forest_presentation(`meta_comp_taar1_vs_antipsychotic_1 day-2 weeks_dizziness`, "safety")
forest_presentation(`meta_comp_taar1_vs_antipsychotic_1 day-2 weeks_nausea_vomitting`, "safety")
forest_presentation(`meta_comp_taar1_vs_antipsychotic_3-13 weeks_nausea_vomitting`, "safety")
forest_presentation(`meta_comp_taar1_vs_antipsychotic_3-13 weeks_weight_increased`, "safety")
forest_presentation(`meta_comp_taar1_vs_antipsychotic_1 day-2 weeks_anxiety`, "safety")
forest_presentation(`meta_comp_taar1_vs_antipsychotic_3-13 weeks_agitation`, "safety")
forest_presentation(`meta_comp_taar1_vs_antipsychotic_1 day-2 weeks_headache`, "safety")
forest_presentation(`meta_comp_taar1_vs_antipsychotic_3-13 weeks_headache`, "safety")
forest_presentation(`meta_comp_taar1_vs_antipsychotic_1 day-2 weeks_sedation`, "safety")
forest_presentation(`meta_comp_taar1_vs_antipsychotic_3-13 weeks_headache`, "safety")
forest_presentation(`meta_comp_taar1_vs_antipsychotic_3-13 weeks_insomnia`, "safety")
safety_primary<-meta_outcome %>% left_join(ae_categories) %>%
mutate(event_text=ifelse(outcome=="death", "Mortality",
ifelse(outcome=="serious", "Serious event",
ifelse(outcome=="dropout_any", "Dropouts any reason",
ifelse(outcome=="dropout_ae", "Dropouts adverse event", event_text)))),
MedDRA_group=ifelse(outcome=="death" | outcome=="serious", "serious",
ifelse(outcome=="dropout_any" | outcome=="dropout_ae", "dropouts", MedDRA_group))) %>%
filter(!is.na(TE)) %>% filter(!is.na(event_text)) %>%
mutate(point=TE,
lb=TE-1.96*seTE,
ub=TE+1.96*seTE) %>% unique() %>%
filter(comparison=="taar1_vs_antipsychotic")
safety_primary_timepoint<-safety_primary %>% filter(timepoint=="3-13 weeks")
safety_primary_plot <-safety_primary %>% filter(event_text %in% safety_primary_timepoint$event_text)
safety_primary_plot$event_text <- factor(safety_primary_plot$event_tex, levels=unique(safety_primary_plot$event_tex))
level_order<- sort(unique(safety_primary_plot$event_text))
lever_order_meddra<-c("dropouts", "any", "serious", "autonomic", "endocrinic", "neuromuscular", "neuropsychiatric")
safety_primary_plot$event_text <- factor(safety_primary_plot$event_tex, levels=unique(safety_primary_plot$event_tex))
level_order<- sort(unique(safety_primary_plot$event_text))
lever_order_meddra<-c("dropouts", "any", "serious", "autonomic", "endocrinic", "neuromuscular", "neuropsychiatric")
ggplot(data=safety_primary_plot,
aes(y=factor(event_text, level=rev(level_order)), x=exp(point), colour=timepoint))+
geom_point(position=position_dodge(width = 0.5))+
geom_errorbar(aes(x=exp(point), xmin=exp(TE-1.96*seTE),
xmax=exp(TE+1.96*seTE), colour=timepoint),
width=0, position=position_dodge(width = 0.5))+
geom_vline(xintercept=1, linetype='dashed')+
facet_grid(factor(MedDRA_group, levels=lever_order_meddra)~., scales = "free", space = "free")+
scale_x_log10() +
ylab("")+
xlab("OR 95%CI")+
theme_bw()
ggplot(data=data_doses, aes(x=dose,
y=-yi,
ymin=-yi+1.96*sqrt(vi), ymax=-yi-1.96*sqrt(vi),
group=study_name, colour=study_name))+
geom_pointrange(position=position_dodge(width = 1.2), aes(shape=schedule), size=1)+
xlim(c(0,150))+
coord_cartesian(ylim=c(-0.5,0.5), expand=TRUE)+
xlab("dose (mg//d)")+
ylab("SMD 95%CI")+
scale_shape_manual(values = c(15,0), guide=FALSE)+
geom_hline(yintercept = 0, linetype="dashed")+
facet_wrap(~drug_name,  scales = "free", nrow=2)+
theme_bw()
studies_primary<-studies %>% filter(Name=="NCT04512066 (2020)"  | Name=="Isaacson (2023)" | Name=="NCT04072354 (2019)" |
Name=="Koblan (2020)" |Name== "NCT04092686 (2019)" | Name== "NCT04825860 (2021)") %>%  mutate(Diagnosis=ifelse(Name=="Isaacson (2023)", "Parksinon disease psychosis", "Schizophrenia spectrum"), `Data availability`=ifelse(Name== "NCT04825860 (2021)", "~",
ifelse(Name=="NCT04072354 (2019)","✓ (adult) / ?(adolescent) " , "✓"))) %>%
select(Name, Diagnosis, `Sample size`, `Data availability`)
knitr::kable(studies_primary[order(studies_primary$Diagnosis, studies_primary$Name),])
812+479
#Manually cleaned dataset from EPPI-reviewer (future iterations will allowed automated cleaning procedures)
data<-read_xlsx("data/LSR3_H_2024-01-22.xlsx")
library(tidyverse)
library(readxl)
library(writexl)
library(meta)
library(metafor)
library(netmeta)
library(metafor)
#Manually cleaned dataset from EPPI-reviewer (future iterations will allowed automated cleaning procedures)
data<-read_xlsx("data/LSR3_H_2024-01-22.xlsx")
library(tidyverse)
library(readxl)
library(writexl)
library(meta)
library(metafor)
library(netmeta)
library(metafor)
#Manually cleaned dataset from EPPI-reviewer (future iterations will allowed automated cleaning procedures)
data<-read_xlsx("data/LSR3_H_2024-01-22.xlsx")
#Tsukada et al 2023: cleaning of the QTc continuous data reported for multiple assessments within a day and the AUC was calculated; then divided by 24 hours)
data_cont<-read_xlsx("data/LSR3_H_qtc_2023-11-24.xlsx") #Manually cleaned data from EPPI reviewer, only QTc continues data to be used here
library(tidyverse)
library(readxl)
library(writexl)
library(meta)
library(metafor)
library(netmeta)
library(metafor)
#Manually cleaned dataset from EPPI-reviewer (future iterations will allowed automated cleaning procedures)
data<-read_xlsx("data/LSR3_H_2024-01-22.xlsx")
#Tsukada et al 2023: cleaning of the QTc continuous data reported for multiple assessments within a day and the AUC was calculated; then divided by 24 hours)
data_cont<-read_xlsx("data/LSR3_H_qtc_2023-11-24.xlsx") #Manually cleaned data from EPPI reviewer, only QTc continues data to be used here
data_qtc<-data_cont %>% filter(grepl("QTc", Title)) %>% #Calculate TE and seTE for the difference between ulotaront placebo for each assessment of the QTc interval in Tsukada et al 203
mutate(timepoint=as.double(gsub("hours","",Timepoint)),
outcome="QTc interval msec", comparison="TAAR1 agonist vs. placebo",
sm="MD", TE=`Mean difference`, seTE=SE...21) %>%
select(outcome, comparison, timepoint, sm, TE, seTE) %>% mutate(lb=TE-1.96*seTE, ub=TE+1.96*seTE)
data_qtc<-data_qtc[order(data_qtc$timepoint),] #Order the QTc assessments by the time of assessmennt
#Function for calculating AUC
AUC <- function (conc, time)
{
auc <- 0
for (i in 2:(length(time))) {
auc <- auc + (time[i] - time[i - 1]) * (conc[i] + conc[i - 1])/2
}
auc
}
#Calculate the mean AUC of QTc interval, and the divide by 24 hours in order to have the overall daily assessment
qtc_auc_mean<-AUC(data_qtc$TE, data_qtc$timepoint)/24
#Calculate the lower boundary of the AUC of QTc interval, and the divide by 24 hours in order to have the overall daily assessment
qtc_aub_lb<-AUC(data_qtc$lb, data_qtc$timepoint)/24
#Calculate the upper boundary of the AUC of QTc interval, and the divide by 24 hours in order to have the overall daily assessment
qtc_aub_ub<-AUC(data_qtc$ub, data_qtc$timepoint)/24
qtc_aub_se<-(qtc_aub_ub-qtc_aub_lb)/3.92
#Add the above-calculated MD differennce for QTc interval between ulotaront and placebo in Tsukada et al 2023
data<-data %>% mutate(qtc_md_point=ifelse(study_name=="Tsukada (2023)", qtc_auc_mean, NA),
qtc_md_se=ifelse(study_name=="Tsukada (2023)",qtc_aub_se, NA))
#save the dataset
write_xlsx(data, "data/data_2023-11-24_LSR3_H.xlsx")
#data_unique_studies<-data %>% select(study_name, study_design, population, state, sample_n, age_mean) %>% unique() #only for descriptives
#Cleaning of the included studies (RCT or not, completed or ongoing)
studies<-(read_xlsx('data/included_studies_2023-11-24_LSR3_H.xlsx', na = "NA"))
library(tidyverse)
library(readxl)
library(writexl)
library(meta)
library(metafor)
library(netmeta)
library(metafor)
#Manually cleaned dataset from EPPI-reviewer (future iterations will allowed automated cleaning procedures)
data<-read_xlsx("data/LSR3_H_2024-01-22.xlsx")
#Tsukada et al 2023: cleaning of the QTc continuous data reported for multiple assessments within a day and the AUC was calculated; then divided by 24 hours)
data_cont<-read_xlsx("data/LSR3_H_qtc_2023-11-24.xlsx") #Manually cleaned data from EPPI reviewer, only QTc continues data to be used here
data_qtc<-data_cont %>% filter(grepl("QTc", Title)) %>% #Calculate TE and seTE for the difference between ulotaront placebo for each assessment of the QTc interval in Tsukada et al 203
mutate(timepoint=as.double(gsub("hours","",Timepoint)),
outcome="QTc interval msec", comparison="TAAR1 agonist vs. placebo",
sm="MD", TE=`Mean difference`, seTE=SE...21) %>%
select(outcome, comparison, timepoint, sm, TE, seTE) %>% mutate(lb=TE-1.96*seTE, ub=TE+1.96*seTE)
data_qtc<-data_qtc[order(data_qtc$timepoint),] #Order the QTc assessments by the time of assessmennt
#Function for calculating AUC
AUC <- function (conc, time)
{
auc <- 0
for (i in 2:(length(time))) {
auc <- auc + (time[i] - time[i - 1]) * (conc[i] + conc[i - 1])/2
}
auc
}
#Calculate the mean AUC of QTc interval, and the divide by 24 hours in order to have the overall daily assessment
qtc_auc_mean<-AUC(data_qtc$TE, data_qtc$timepoint)/24
#Calculate the lower boundary of the AUC of QTc interval, and the divide by 24 hours in order to have the overall daily assessment
qtc_aub_lb<-AUC(data_qtc$lb, data_qtc$timepoint)/24
#Calculate the upper boundary of the AUC of QTc interval, and the divide by 24 hours in order to have the overall daily assessment
qtc_aub_ub<-AUC(data_qtc$ub, data_qtc$timepoint)/24
qtc_aub_se<-(qtc_aub_ub-qtc_aub_lb)/3.92
#Add the above-calculated MD differennce for QTc interval between ulotaront and placebo in Tsukada et al 2023
data<-data %>% mutate(qtc_md_point=ifelse(study_name=="Tsukada (2023)", qtc_auc_mean, NA),
qtc_md_se=ifelse(study_name=="Tsukada (2023)",qtc_aub_se, NA))
#save the dataset
write_xlsx(data, "data/data_2024-01-22_LSR3_H.xlsx")
#data_unique_studies<-data %>% select(study_name, study_design, population, state, sample_n, age_mean) %>% unique() #only for descriptives
#Cleaning of the included studies (RCT or not, completed or ongoing)
studies<-(read_xlsx('data/included_studies_2023-11-24_LSR3_H.xlsx', na = "NA"))
library(tidyverse)
library(readxl)
library(writexl)
library(meta)
library(metafor)
library(netmeta)
library(metafor)
#Manually cleaned dataset from EPPI-reviewer (future iterations will allowed automated cleaning procedures)
data<-read_xlsx("data/LSR3_H_2024-01-22.xlsx")
#Tsukada et al 2023: cleaning of the QTc continuous data reported for multiple assessments within a day and the AUC was calculated; then divided by 24 hours)
data_cont<-read_xlsx("data/LSR3_H_qtc_2023-11-24.xlsx") #Manually cleaned data from EPPI reviewer, only QTc continues data to be used here
data_qtc<-data_cont %>% filter(grepl("QTc", Title)) %>% #Calculate TE and seTE for the difference between ulotaront placebo for each assessment of the QTc interval in Tsukada et al 203
mutate(timepoint=as.double(gsub("hours","",Timepoint)),
outcome="QTc interval msec", comparison="TAAR1 agonist vs. placebo",
sm="MD", TE=`Mean difference`, seTE=SE...21) %>%
select(outcome, comparison, timepoint, sm, TE, seTE) %>% mutate(lb=TE-1.96*seTE, ub=TE+1.96*seTE)
data_qtc<-data_qtc[order(data_qtc$timepoint),] #Order the QTc assessments by the time of assessmennt
#Function for calculating AUC
AUC <- function (conc, time)
{
auc <- 0
for (i in 2:(length(time))) {
auc <- auc + (time[i] - time[i - 1]) * (conc[i] + conc[i - 1])/2
}
auc
}
#Calculate the mean AUC of QTc interval, and the divide by 24 hours in order to have the overall daily assessment
qtc_auc_mean<-AUC(data_qtc$TE, data_qtc$timepoint)/24
#Calculate the lower boundary of the AUC of QTc interval, and the divide by 24 hours in order to have the overall daily assessment
qtc_aub_lb<-AUC(data_qtc$lb, data_qtc$timepoint)/24
#Calculate the upper boundary of the AUC of QTc interval, and the divide by 24 hours in order to have the overall daily assessment
qtc_aub_ub<-AUC(data_qtc$ub, data_qtc$timepoint)/24
qtc_aub_se<-(qtc_aub_ub-qtc_aub_lb)/3.92
#Add the above-calculated MD differennce for QTc interval between ulotaront and placebo in Tsukada et al 2023
data<-data %>% mutate(qtc_md_point=ifelse(study_name=="Tsukada (2023)", qtc_auc_mean, NA),
qtc_md_se=ifelse(study_name=="Tsukada (2023)",qtc_aub_se, NA))
#save the dataset
write_xlsx(data, "data/data_2024-01-22_LSR3_H.xlsx")
#data_unique_studies<-data %>% select(study_name, study_design, population, state, sample_n, age_mean) %>% unique() #only for descriptives
#Cleaning of the included studies (RCT or not, completed or ongoing)
studies<-(read_xlsx('data/included_studies_2024-01-22_LSR3_H.xlsx', na = "NA"))
studies<-studies %>% mutate(rct=ifelse(grepl("RCT", Design), 1,0),
conditions=ifelse(grepl("schizophrenia", Population),"Schizophrenia",
ifelse(grepl("Parkinson", Population),"Parkinson's disease psychosis",
ifelse(grepl("narcolepsy/cataplexy", Population) |
grepl("MDD", Population) |
grepl("GAD", Population), "Other mental health conditions", "Healthy volunteers"))),
state=ifelse(grepl("acute", Population),"acute",
ifelse(grepl("negative", Population),"negative symptoms",
ifelse(grepl("stable", Population),"stable", NA)))) %>%
mutate(sample_n=as.integer(`Sample size`)) %>% filter(rct==1)
studies<-studies[order(studies$Status, studies$Sponsor, studies$rct, studies$Population, studies$state),] #Ordering for a better presentation
write_xlsx(studies, 'data/studies_2024-01-22_LSR3_H.xlsx')
#Dataset with effect sizes for the different doses in order to plot them separately
master<-data
master_sch<-master %>% filter(population=="Schizophrenia spectrum" & timepoint=="3-13 weeks" &
study_design=="parallel-RCT" & drug_name!="risperidone") %>%
select(study_name, drug_name, dose, overall_mean, overall_sd, overall_n)
master_sch_placebo<-master_sch %>% filter(drug_name=="placebo") %>%
rename(placebo_mean=overall_mean, placebo_sd=overall_sd, placebo_n=overall_n) %>%
select(study_name, placebo_mean, placebo_sd, placebo_n)
master_sch_drug<-master_sch %>% filter(drug_name!="placebo") %>%
left_join(master_sch_placebo)
master_sch_arms<-master_sch_drug %>% select(study_name) %>% group_by(study_name) %>% summarise(dose_arms=n())
master_sch_drug<-master_sch_drug %>% left_join(master_sch_arms) %>%
mutate(placebo_n=as.integer(placebo_n/dose_arms))
master_sch_drug<-escalc(measure="SMD", data=master_sch_drug, m1i=overall_mean, m2i=placebo_mean,
sd1i=overall_sd, sd2i=placebo_sd, n1i=overall_n, n2i=placebo_n)
master_sch_drug<-master_sch_drug %>% mutate(dose=ifelse(dose=="50-75", 62.5, as.integer(dose))) %>%
mutate(drug_name=ifelse(drug_name=="ulotaront", "1. ulotaront", "2. ralmitaront"),
schedule=ifelse(study_name=="Koblan (2020)", "flexible", "fixed"))
write_xlsx(master_sch_drug, "data/data_doses_2024-01-22_LSR3_H.xlsx")
### libraries
library(meta)
library(tidyverse)
library(tibble)
library(stringr)
library(readxl)
library(grid)
library(dplyr)
library(knitr)
library(kableExtra)
library(meta)
library(devtools)
library(metafor)
library(robvis)
devtools::install_github("haozhu233/kableExtra")
#Empty the enviroment
rm(list=ls())
# Set option defaults
knitr::opts_chunk$set(echo = T, warning = F, message = F)
#Functions needed to run this script
source("util/util.R") #Spiros: I had problems to run this function as a separate file in util.R so i included it within the analysis.R below, theni could run the markdown.
#Data cleaning routines
source("data/clean_data.R")
#Data analysis routines
source("util/analysis.R")
#Data analysis routines
source("util/analysis.R")
# Loading
studies<-read_xlsx('data/studies_2024-01-22_LSR3_H.xlsx', na = "NA") #Descriptive data set with all included studies (RCT and not)
data <- read_xlsx('data/data_2024-01-22_LSR3_H.xlsx') #Clean data with the RCTs with available data
data_doses<-read_xlsx("data/data_doses_2024-01-22_LSR3_H.xlsx") #Effect sizes for the individual doses of TAAR1 (for descriptive figure)
ae_categories<-read_xlsx("data/ae_categories.xlsx") #Supporting file with the names of adverse events for the summary plot for the side-effects
#Round off results to two digits
options(scipen=1, digits=2)
knitr::kable(studies[, 1:14])
### libraries
library(meta)
library(tidyverse)
library(tibble)
library(stringr)
library(readxl)
library(grid)
library(dplyr)
library(knitr)
library(kableExtra)
library(meta)
library(devtools)
library(metafor)
library(robvis)
#devtools::install_github("haozhu233/kableExtra")
#Empty the enviroment
rm(list=ls())
# Set option defaults
knitr::opts_chunk$set(echo = T, warning = F, message = F)
#Functions needed to run this script
source("util/util.R") #Spiros: I had problems to run this function as a separate file in util.R so i included it within the analysis.R below, theni could run the markdown.
#Data cleaning routines
source("data/clean_data.R")
#Data analysis routines
source("util/analysis.R")
# Loading
studies<-read_xlsx('data/studies_2024-01-22_LSR3_H.xlsx', na = "NA") #Descriptive data set with all included studies (RCT and not)
data <- read_xlsx('data/data_2024-01-22_LSR3_H.xlsx') #Clean data with the RCTs with available data
data_doses<-read_xlsx("data/data_doses_2024-01-22_LSR3_H.xlsx") #Effect sizes for the individual doses of TAAR1 (for descriptive figure)
ae_categories<-read_xlsx("data/ae_categories.xlsx") #Supporting file with the names of adverse events for the summary plot for the side-effects
#Round off results to two digits
options(scipen=1, digits=2)
forest(`meta_comp_taar1_vs_placebo_3-13 weeks_overall`,
rightcols = c("effect", "ci", "rob"),
rightlabs = c("SMD", "95%-CI", "Risk of bias"),  xlim=c(-0.8,0.8),
label.e = unique(`meta_comp_taar1_vs_placebo_3-13 weeks_overall`$data$treat1_new), label.c=unique(`meta_comp_taar1_vs_placebo_3-13 weeks_overall`$data$treat2_new),
subgroup.hetstat = TRUE, overall.hetstat =FALSE, test.subgroup.random = FALSE,
overall = FALSE, prediction.subgroup = FALSE,
subgroup = TRUE,
label.left = "Placebo better", label.right="TAAR1 better")
forest(`meta_comp_taar1_vs_placebo_3-13 weeks_overall`,
rightcols = c("effect", "ci", "rob"),
rightlabs = c("SMD", "95%-CI", "Risk of bias"),  xlim=c(-0.8,0.8),
label.e = unique(`meta_comp_taar1_vs_placebo_3-13 weeks_overall`$data$treat1_new), label.c=unique(`meta_comp_taar1_vs_placebo_3-13 weeks_overall`$data$treat2_new),
subgroup.hetstat = TRUE, overall.hetstat =FALSE, test.subgroup.random = FALSE,
overall = FALSE, prediction.subgroup = FALSE,
subgroup = TRUE, fixed=TRUE,
label.left = "Placebo better", label.right="TAAR1 better")
forest_presentation(`meta_comp_taar1_vs_placebo_3-13 weeks_positive`, "efficacy")
forest(`meta_comp_taar1_vs_placebo_3-13 weeks_positive`,
rightcols = c("effect", "ci", "rob"),
rightlabs = c("SMD", "95%-CI", "Risk of bias"),  xlim=c(-0.8,0.8),
label.e = unique(`meta_comp_taar1_vs_placebo_3-13 weeks_overall`$data$treat1_new), label.c=unique(`meta_comp_taar1_vs_placebo_3-13 weeks_overall`$data$treat2_new),
subgroup.hetstat = TRUE, overall.hetstat =FALSE, test.subgroup.random = FALSE,
overall = FALSE, prediction.subgroup = FALSE,
subgroup = TRUE, fixed=TRUE,
label.left = "Placebo better", label.right="TAAR1 better")
forest(`meta_comp_taar1_vs_placebo_3-13 weeks_positive`,
rightcols = c("effect", "ci", "rob"),
rightlabs = c("SMD", "95%-CI", "Risk of bias"),  xlim=c(-0.8,0.8),
label.e = unique(`meta_comp_taar1_vs_placebo_3-13 weeks_overall`$data$treat1_new), label.c=unique(`meta_comp_taar1_vs_placebo_3-13 weeks_overall`$data$treat2_new),
subgroup.hetstat = TRUE, overall.hetstat =FALSE, test.subgroup.random = FALSE,
overall = FALSE, prediction.subgroup = FALSE,
subgroup = TRUE, fixed=TRUE,
label.left = "Placebo better", label.right="TAAR1 better")
forest(`meta_comp_taar1_vs_placebo_3-13 weeks_positive`,
rightcols = c("effect", "ci", "rob"),
rightlabs = c("SMD", "95%-CI", "Risk of bias"),  xlim=c(-0.8,0.8),
label.e = unique(`meta_comp_taar1_vs_placebo_3-13 weeks_overall`$data$treat1_new), label.c=unique(`meta_comp_taar1_vs_placebo_3-13 weeks_forest`$data$treat2_new),
subgroup.hetstat = TRUE, overall.hetstat =FALSE, test.subgroup.random = FALSE,
overall = FALSE, prediction.subgroup = FALSE,
subgroup = TRUE, fixed=TRUE,
label.left = "Placebo better", label.right="TAAR1 better")
label.e = unique(`meta_comp_taar1_vs_placebo_3-13 weeks_overall`$data$treat1_new), label.c=unique(#`meta_comp_taar1_vs_placebo_3-13 weeks_forest`$data$treat2_new),
forest(`meta_comp_taar1_vs_placebo_3-13 weeks_positive`,
rightcols = c("effect", "ci", "rob"),
rightlabs = c("SMD", "95%-CI", "Risk of bias"),  xlim=c(-0.8,0.8),
label.e = unique(`meta_comp_taar1_vs_placebo_3-13 weeks_overall`$data$treat1_new), #label.c=unique(`meta_comp_taar1_vs_placebo_3-13 weeks_forest`$data$treat2_new),
subgroup.hetstat = TRUE, overall.hetstat =FALSE, test.subgroup.random = FALSE,
overall = FALSE, prediction.subgroup = FALSE,
subgroup = TRUE, fixed=TRUE,
label.left = "Placebo better", label.right="TAAR1 better")
forest(`meta_comp_taar1_vs_placebo_3-13 weeks_positive`,
rightcols = c("effect", "ci", "rob"),
rightlabs = c("SMD", "95%-CI", "Risk of bias"),  xlim=c(-0.8,0.8),
label.e = unique(`meta_comp_taar1_vs_placebo_3-13 weeks_positive`$data$treat1_new), #label.c=unique(`meta_comp_taar1_vs_placebo_3-13 weeks_forest`$data$treat2_new),
subgroup.hetstat = TRUE, overall.hetstat =FALSE, test.subgroup.random = FALSE,
overall = FALSE, prediction.subgroup = FALSE,
subgroup = TRUE, fixed=TRUE,
label.left = "Placebo better", label.right="TAAR1 better")
forest(`meta_comp_taar1_vs_placebo_3-13 weeks_positive`,
rightcols = c("effect", "ci"),
rightlabs = c("SMD", "95%-CI"),  xlim=c(-0.8,0.8),
label.e = unique(`meta_comp_taar1_vs_placebo_3-13 weeks_positive`$data$treat1_new), #label.c=unique(`meta_comp_taar1_vs_placebo_3-13 weeks_forest`$data$treat2_new),
subgroup.hetstat = TRUE, overall.hetstat =FALSE, test.subgroup.random = FALSE,
overall = FALSE, prediction.subgroup = FALSE,
subgroup = TRUE, fixed=TRUE,
label.left = "Placebo better", label.right="TAAR1 better")
