ifelse(duration=="6-6", "6 weeks", NA)))))) %>%
mutate(outcome_type=ifelse(outcome %in% effic_outcomes, "efficacy", "other")) %>%
mutate(n_possible=ifelse(timepoint=="1 day-2 weeks" & comparison=="taar1_vs_antipsychotic", 100,
ifelse(timepoint=="1 day-2 weeks" & comparison=="taar1_vs_placebo", 626,
ifelse(timepoint=="3-13 weeks" & comparison=="taar1_vs_placebo" & outcome_type=="efficacy" & population=="Schizophrenia spectrum", 1383,
ifelse(timepoint=="3-13 weeks" & comparison=="taar1_vs_placebo" & outcome_type=="efficacy" & population=="Parkinson Disease Psychosis", 39,
ifelse(timepoint=="3-13 weeks" & comparison=="taar1_vs_antipsychotic" & population=="Schizophrenia spectrum", 128,1550)))))) %>% #Added the negative symptom study too
mutate(k_possible=ifelse(timepoint=="1 day-2 weeks" & comparison=="taar1_vs_antipsychotic", 2,
ifelse(timepoint=="1 day-2 weeks" & comparison=="taar1_vs_placebo", 12,
ifelse(timepoint=="3-13 weeks" & comparison=="taar1_vs_placebo" & outcome_type=="efficacy" & population=="Schizophrenia spectrum", 4,
ifelse(timepoint=="3-13 weeks" & comparison=="taar1_vs_placebo" & outcome_type=="efficacy" & population=="Parkinson Disease Psychosis", 1,
ifelse(timepoint=="3-13 weeks" & comparison=="taar1_vs_antipsychotic" & population=="Schizophrenia spectrum", 1,6)))))) %>%
mutate(k_prop=k/k_possible,
n_prop=ifelse(k_prop==1, 1, n/n_possible),
k_schiz_prop=k_schiz/k, n_schiz_prop=n_schiz/n,
moderate_to_high_bias_prop=(moderate_bias+high_bias)/k) %>%
mutate(TE_lb.random=TE.random-1.96*seTE.random,
TE_ub.random=TE.random+1.96*seTE.random,
TE_lb.fixed=TE.fixed-1.96*seTE.fixed,
TE_ub.fixed=TE.fixed+1.96*seTE.fixed) %>%
mutate(cer_point=exp(TE.placebo.random)/(1+exp(TE.placebo.random))) %>%
mutate(point.random=ifelse(sm=="OR", round(exp(TE.random), 2), round(TE.random, 2)),
lb.random=ifelse(sm=="OR", round(exp(TE_lb.random), 2), round(TE_lb.random, 2)),
ub.random=ifelse(sm=="OR", round(exp(TE_ub.random), 2), round(TE_ub.random, 2)),
point.fixed=ifelse(sm=="OR", round(exp(TE.fixed), 2), round(TE.fixed, 2)),
lb.fixed=ifelse(sm=="OR", round(exp(TE_lb.fixed), 2), round(TE_lb.fixed, 2)),
ub.fixed=ifelse(sm=="OR", round(exp(TE_ub.fixed), 2), round(TE_ub.fixed, 2))) %>%
mutate(ACR=ifelse(sm=="OR", round(100*point.random*cer_point/(1-cer_point+point.random*cer_point),1), NA),
CER=ifelse(!is.na(point.random), round(100*cer_point, 1), NA),
t2=round(tau2,4)) %>%
mutate(association=ifelse(!is.na(point.random),
ifelse(k>1 & !is.na(t2), ifelse(sm=="OR", paste0("N=", k, " n=", n, "; Random-effects: ", ACR,"% vs. ", CER,"%, ",
sm,"=",point.random,", 95%CI: ", lb.random, ", ", ub.random,"; Fixed-effecs: ",
sm,"=",point.fixed,", 95%CI: ", lb.fixed, ", ", ub.fixed),
paste0("N=", k, " n=", n, "; Random-effects: ", sm,"=",point.random,", 95%CI: ", lb.random, ", ", ub.random,"; Fixed-effecs: ",
sm,"=",point.fixed,", 95%CI: ", lb.fixed, ", ", ub.fixed)),
ifelse(sm=="OR", paste0("N=", k, " n=", n, "; ", ACR,"% vs. ", CER,"%, ", sm,"=",point.random,", 95%CI: ", lb.random, ", ", ub.random),
paste0("N=", k, " n=", n, "; ", sm,"=",point.random,", 95%CI: ", lb.random, ", ", ub.random))),
paste0("N=", k, " n=", n, "; not estimable effect size 0 events in both arms")),
study_limitations=ifelse(moderate_to_high_bias_prop==0 & k==1, "1 study with an overall low risk of bias",
ifelse(moderate_bias==1 & k==1, "1 study with overall some concerns in risk of bias",
ifelse(high_bias==1 & k==1, "1 study with overall high risk of bias",
ifelse(moderate_to_high_bias_prop==0 & k>1, " All studies had overall low risk of bias",
paste0(round(100*(1-moderate_to_high_bias_prop),1),"% had overall low risk of bias"))))),
reporting_bias=ifelse(k_prop==1 & k_possible==1, "1 eligible study with usable data",
ifelse(k_prop==1 & k_possible>1, paste0("All eligible studies had usable data"),
ifelse(k_prop<1, paste0(round(100*k_prop,1), "% of eligible studies and ", round(100*n_prop,1),"% of participants had usable data"), NA))),
indirectness=ifelse(outcome_type=="efficacy", "No clear indication of indirectness",
ifelse(k_schiz_prop==1, "No clear indication of indirectness",
paste0(round(100*k_schiz_prop,1), "% studies and ", round(100*n_schiz_prop,1), "% participants with schizophrenia")))) %>%
mutate(population=ifelse(outcome_type=="efficacy", population, NA),
id_outcome_population=paste0(outcome, population))  %>%
left_join(outcome_names)  %>%
select(comparison, outcome_type, id_outcome_population, order, outcome_new, population, timepoint, duration, association, study_limitations, reporting_bias, indirectness) %>%
mutate(outcome_new=ifelse(id_outcome_population=="positiveParkinson Disease Psychosis", "Positive symptoms (SAPS-PD)", #Manually add some variables that were not added before
ifelse(id_outcome_population=="overallParkinson Disease Psychosis", "Overall symptoms (NPI)",
ifelse(id_outcome_population=="cognitionParkinson Disease Psychosis", "Cognitive impairment (MMSE)",
ifelse(id_outcome_population=="responseParkinson Disease Psychosis", "Response to treatment (â‰¥50% in SAPS-PD)", outcome_new))))) %>%
mutate(order=ifelse(id_outcome_population=="positiveParkinson Disease Psychosis", 3, #Manually add some variables that were not added before
ifelse(id_outcome_population=="overallParkinson Disease Psychosis", 1,
ifelse(id_outcome_population=="cognitionParkinson Disease Psychosis", 6,
ifelse(id_outcome_population=="responseParkinson Disease Psychosis", 2, order))))) %>%
mutate(comparison_order=ifelse(comparison=="taar1_vs_placebo",1,2),
population_order=ifelse(population=="Schizophrenia spectrum", 1,
ifelse(population=="Parkinson Disease Psychosis", 2, 3)),
time_order=ifelse(timepoint=="3-13 weeks",1,2)) %>%
mutate(text_comparison=ifelse(comparison=="taar1_vs_placebo", paste0('TAAR1 agonists vs. placebo'), "TAAR1 agonists vs. antipsychotics")) %>%
mutate(text_population=ifelse(is.na(population), "any eligible population",
ifelse(population=="Schizophrenia spectrum","adults with schizophrenia","Parkinson Disease Psychosis"))) %>%
mutate(text_description=paste0(text_comparison," in ", text_population)) %>%
mutate(other_bias=ifelse(comparison=="taar1_vs_placebo" & (id_outcome_population=="overallSchizophrenia spectrum" | id_outcome_population=="responseSchizophrenia spectrum"),
"Two phase III trials conducted during COVID-19, which could be associated with factors assocaited with increased placebo effects and smaller effect sizes", "No clear indication of other biases"))
meta_outcome_soe<-meta_outcome_soe[order(meta_outcome_soe$comparison_order, meta_outcome_soe$outcome_type,
meta_outcome_soe$population_order,
meta_outcome_soe$order, meta_outcome_soe$time_order),]
meta_outcome_soe<-meta_outcome_soe %>% select(text_description, outcome_type, outcome_new, duration, association, study_limitations, reporting_bias, indirectness, other_bias)
write_xlsx(meta_outcome_soe, "data/meta_outcome_soe.xlsx")
#Meta-analysis of the primary outcome for schizophrenia per TAAR1 agonist (using the same code as above)
master_drug<- master %>%
filter(timepoint=="3-13 weeks") %>%
filter(population=="Schizophrenia spectrum") %>%
filter(!is.na(overall_mean)) %>%
select(study_name, study_name_drug, crossover_periods, population, duration_weeks,drug_new, drug_name, dose, overall_mean, overall_sd, overall_n) %>%
filter(drug_new=="TAAR1 agonist" | drug_new=="placebo")
master_pooled_drug<-master_drug %>%
group_by(study_name, study_name_drug, drug_name, population, duration_weeks)%>%
summarise(n_an=sum(overall_n),
mean_an=weighted.mean(overall_mean,overall_n),
sd_an=sqrt(((sum((overall_n - 1) * overall_sd^2 + overall_n * overall_mean^2)) - sum(overall_n) * mean_an^2)/(sum(overall_n) -  1)))
master_pooled_drug_studies<-master_pooled_drug %>%
select(study_name) %>% group_by(study_name) %>% summarise(count=n()) %>% filter(count!=1)
master_pooled_drug<-master_pooled_drug %>% filter(study_name %in% master_pooled_drug_studies$study_name)
pairwise_drug<-pairwise(data=master_pooled_drug, studlab = study_name_drug, treat=drug_name,
mean=mean_an, sd=sd_an, n=n_an, sm="SMD")
pairwise_drug<-as.data.frame(pairwise_drug) %>%
mutate(treat1_new=ifelse(treat1!="placebo" , treat1, treat2),
treat2_new=ifelse(treat1!="placebo" , treat2, treat1),
mean1_new=ifelse(treat1!="placebo" , -1*mean1, -1*mean2),
mean2_new=ifelse(treat1!="placebo" , -1*mean2, -1*mean1),
sd1_new=ifelse(treat1!="placebo" , sd1, sd2),
sd2_new=ifelse(treat1!="placebo" , sd2, sd1),
n1_new=ifelse(treat1!="placebo" ,n1, n2),
n2_new=ifelse(treat1!="placebo" , n2, n1)) %>%
mutate(comp=paste0(treat1_new," vs. ", treat2_new)) %>%
select(study_name, study_name_drug, duration_weeks,
comp, population, treat1_new, treat2_new, mean1_new, sd1_new, n1_new, mean2_new,  sd2_new, n2_new) %>%
mutate(n_total=n1_new + n2_new) %>%
mutate(drug=treat1_new) %>%
unique()
rob_drug<-rob %>% filter(outcome=="overall" & timepoint=="3-13 weeks")
pairwise_drug<- pairwise_drug %>% left_join(rob_drug) %>%
unique()
meta_comp_drug<-metacont(data=pairwise_drug,
mean.e = mean1_new, sd.e=sd1_new, n.e=n1_new, mean.c = mean2_new, sd.c=sd2_new, n.c=n2_new,
sm="SMD", random=TRUE, fixed=TRUE,
studlab = study_name_drug, prediction = FALSE, subgroup = drug,
prediction.subgroup = FALSE)
#Meta-analysis of the efficacy outcomes for acute schizophenia and Parkinson's disease psyschosis in order to present them in separate forest plots
master_separate<- master %>%
filter(timepoint=="3-13 weeks") %>%
filter(!is.na(overall_mean)) %>%
select(study_name, study_name_drug, crossover_periods, population, duration_weeks,drug_new,
overall_mean, overall_sd, overall_n,
positive_mean, positive_sd, positive_n,
response_e, randomized_n) %>%
filter(drug_new=="TAAR1 agonist" | drug_new=="placebo")
master_pooled_separate <-master_separate %>%
group_by(study_name, study_name_drug, drug_new, population, duration_weeks)%>%
summarise(n_an=sum(randomized_n),
response_an=sum(as.integer(response_e)),
n_ov_an=sum(overall_n),
mean_ov_an=weighted.mean(overall_mean,overall_n),
sd_ov_an=sqrt(((sum((overall_n - 1) * overall_sd^2 + overall_n * overall_mean^2)) - sum(overall_n) * mean_ov_an^2)/(sum(overall_n) -  1)),
n_pos_an=sum(positive_n),
mean_pos_an=weighted.mean(positive_mean,positive_n),
sd_pos_an=sqrt(((sum((positive_n - 1) * positive_sd^2 + positive_n * positive_mean^2)) - sum(positive_n) * mean_pos_an^2)/(sum(positive_n) -  1)))
pairwise_separate<-pairwise(data=master_pooled_separate, studlab = study_name_drug, treat=drug_new,
mean=mean_ov_an, sd=sd_ov_an, n=n_ov_an, sm="SMD")
pairwise_separate<-as.data.frame(pairwise_separate) %>%
mutate(treat1_new=ifelse(treat1!="placebo" , treat1, treat2),
treat2_new=ifelse(treat1!="placebo" , treat2, treat1),
overall_mean1_new=ifelse(treat1!="placebo" , -1*mean1, -1*mean2),
overall_mean2_new=ifelse(treat1!="placebo" , -1*mean2, -1*mean1),
overall_sd1_new=ifelse(treat1!="placebo" , sd1, sd2),
overall_sd2_new=ifelse(treat1!="placebo" , sd2, sd1),
overall_n1_new=ifelse(treat1!="placebo" ,n1, n2),
overall_n2_new=ifelse(treat1!="placebo" , n2, n1),
positive_mean1_new=ifelse(treat1!="placebo" , -1*mean_pos_an1, -1*mean_pos_an2),
positive_mean2_new=ifelse(treat1!="placebo" , -1*mean_pos_an2, -1*mean_pos_an1),
positive_sd1_new=ifelse(treat1!="placebo" , sd_pos_an1, sd_pos_an2),
positive_sd2_new=ifelse(treat1!="placebo" , sd_pos_an2, sd_pos_an1),
positive_n1_new=ifelse(treat1!="placebo" ,n_pos_an1, n_pos_an2),
positive_n2_new=ifelse(treat1!="placebo" , n_pos_an2, n_pos_an1),
response1=ifelse(treat1!="placebo" ,response_an1, response_an2),
response2=ifelse(treat1!="placebo" ,response_an2, response_an2),
random1=ifelse(treat1!="placebo" ,n_an1, n_an2),
random2=ifelse(treat1!="placebo" ,n_an2, n_an1)) %>%
mutate(comp=paste0(treat1_new," vs. ", treat2_new)) %>%
select(study_name, study_name_drug, duration_weeks,
comp, population, treat1_new, treat2_new,
overall_mean1_new,  overall_sd1_new,  overall_n1_new,  overall_mean2_new,  overall_sd2_new,  overall_n2_new,
positive_mean1_new, positive_sd1_new, positive_n1_new, positive_mean2_new,  positive_sd2_new, positive_n2_new,
response1, random1, response2, random2) %>%
unique()
pairwise_separate_overall<-pairwise_separate
rob_overall<-rob %>% filter(outcome=="overall" & timepoint=="3-13 weeks")  %>% select(study_name, Overall) %>% rename(Overall_overall=Overall)
rob_positive<-rob %>% filter(outcome=="positive" & timepoint=="3-13 weeks")  %>% select(study_name, Overall)%>% rename(Overall_positive=Overall)
rob_resopnse<-rob %>% filter(outcome=="response" & timepoint=="3-13 weeks")  %>% select(study_name, Overall)%>% rename(Overall_response=Overall)
pairwise_separate_overall<-pairwise_separate %>% left_join(rob_overall) %>% left_join(rob_positive) %>% left_join(rob_resopnse)
meta_comp_overall_sch<-metacont(data=pairwise_separate[pairwise_separate$population=="Schizophrenia spectrum",],
mean.e = overall_mean1_new, sd.e=overall_sd1_new, n.e=overall_n1_new, mean.c = overall_mean2_new, sd.c=overall_sd2_new, n.c=overall_n2_new,
sm="SMD", random=TRUE, fixed=TRUE,
studlab = study_name_drug, prediction = FALSE, subgroup = population,
prediction.subgroup = FALSE)
meta_comp_overall_pdp<-metacont(data=pairwise_separate[pairwise_separate$population=="Parkinson Disease Psychosis",],
mean.e = overall_mean1_new, sd.e=overall_sd1_new, n.e=overall_n1_new, mean.c = overall_mean2_new, sd.c=overall_sd2_new, n.c=overall_n2_new,
sm="SMD", random=TRUE, fixed=TRUE,
studlab = study_name_drug, prediction = FALSE, subgroup = population,
prediction.subgroup = FALSE)
meta_comp_positive_sch<-metacont(data=pairwise_separate[pairwise_separate$population=="Schizophrenia spectrum" & !is.na(pairwise_separate$positive_mean1_new),],
mean.e = positive_mean1_new, sd.e=positive_sd1_new, n.e=positive_n1_new, mean.c = positive_mean2_new, sd.c=positive_sd2_new, n.c=positive_n2_new,
sm="SMD", random=TRUE, fixed=TRUE,
studlab = study_name_drug, prediction = FALSE, subgroup = population,
prediction.subgroup = FALSE)
meta_comp_positive_pdp<-metacont(data=pairwise_separate[pairwise_separate$population=="Parkinson Disease Psychosis",],
mean.e = positive_mean1_new, sd.e=positive_sd1_new, n.e=positive_n1_new, mean.c = positive_mean2_new, sd.c=positive_sd2_new, n.c=positive_n2_new,
sm="SMD", random=TRUE, fixed=TRUE,
studlab = study_name_drug, prediction = FALSE, subgroup = population,
prediction.subgroup = FALSE)
meta_comp_response_sch<-metabin(data=pairwise_separate[pairwise_separate$population=="Schizophrenia spectrum",],
event.e = response1, n.e=random1, event.c = response2, n.c=random2,
sm="OR", random=TRUE, fixed=TRUE,
studlab = study_name_drug, prediction = FALSE, subgroup = population,
prediction.subgroup = FALSE)
meta_comp_response_pdp<-metabin(data=pairwise_separate[pairwise_separate$population=="Parkinson Disease Psychosis",],
event.e = response1, n.e=random1, event.c = response2, n.c=random2,
sm="OR", random=TRUE, fixed=TRUE,
studlab = study_name_drug, prediction = FALSE, subgroup = population,
prediction.subgroup = FALSE)
#Overall risk of bias of the studies using the highest across outcomes
rob_all<-rob %>% select(study_name, D1, D2, D3, D4, D5, DS, Overall)
rob_all[rob_all=="Low"]<-"0"
rob_all[rob_all=="Some concerns"]<-"1"
rob_all[rob_all=="High"]<-"2"
rob_all<-rob_all %>% group_by(study_name) %>%
summarise(D1=as.character(max(as.integer(D1))),
D2=as.character(max(as.integer(D2))),
D3=as.character(max(as.integer(D3))),
D4=as.character(max(as.integer(D4))),
D5=as.character(max(as.integer(D5))),
DS=as.character(max(as.integer(DS))),
Overall=as.character(max(as.integer(Overall))))
rob_all[rob_all==0]<-"Low"
rob_all[rob_all==1]<-"Some concerns"
rob_all[rob_all==2]<-"High"
colnames(rob_all) <- c("Study", "Bias due to randomization", "Bias due to deviations from intended intervention",
"Bias due to missing data", "Bias due to outcome measurement", "Bias due to selected reported results",
"Bias due to period and carryover effects", "Overall bias")
#Function to create RoB plots
rob_plot<-function(data){ #RoB function using the extended meta objects
data<-data$data[, c("study_name","D1", "D2", "D3", "D4", "D5", "DS", "Overall")]
colnames(data) <- c("Study", "Bias due to randomization", "Bias due to deviations from intended intervention",
"Bias due to missing data", "Bias due to outcome measurement", "Bias due to selected reported results",
"Bias due to period and carryover effects", "Overall bias")
rob_traffic<-rob_traffic_light(data=data, tool = "Generic",  psize = 12)
return(rob_traffic)
}
rob_summary<-function(data){ #RoB function using the extended meta objects
data<-data$data[, c("study_name","D1", "D2", "D3", "D4", "D5", "DS", "Overall")]
colnames(data) <- c("Study", "Bias due to randomization", "Bias due to deviations from intended intervention",
"Bias due to missing data", "Bias due to outcome measurement", "Bias due to selected reported results",
"Bias due to period and carryover effects", "Overall bias")
rob_summary<-rob_summary(data=data, tool = "Generic",  psize = 12)
return(rob_summary)
}
### libraries
library(meta)
library(tidyverse)
library(tibble)
library(stringr)
library(readxl)
library(grid)
library(dplyr)
library(knitr)
library(kableExtra)
library(meta)
library(devtools)
library(metafor)
library(robvis) #Need to install from devtools::install_github("mcguinlu/robvis")
library(PRISMA2020)
#devtools::install_github("haozhu233/kableExtra") I need to remove this, otherwise the R markdown didnt work
#Empty the enviroment
rm(list=ls())
# Set option defaults
knitr::opts_chunk$set(echo = T, warning = F, message = F)
#Data cleaning routines
source("data/clean_data.R")
#Data analysis routines and functions
source("util/analysis.R")
# Loading
studies<-read_xlsx('data/studies_2024-01-22_LSR3_H.xlsx', na = "NA") #Descriptive data set with included studies
data <- read_xlsx('data/data_2024-01-22_LSR3_H.xlsx') #Clean data with the RCTs with available data
data_doses<-read_xlsx("data/data_doses_2024-01-22_LSR3_H.xlsx") #Effect sizes for the individual doses of TAAR1 (for a descriptive figure)
ae_categories<-read_xlsx("data/ae_categories.xlsx") #Supporting file with the names of adverse events for the summary plot for the side-effects
#prisma data
prisma<-read.csv("data/LSR3_H_PRISMA_2024.01.23.csv") #csv file for the prisma2020
prisma<-PRISMA_data(prisma)
#risk of bias data
rob<-read_xlsx("data/rob_secondary_2024.01.24.xlsx")
#results matrix table
results_matrix<-read_xlsx("data/reporting_bias table_2024.01.26.xlsx")
#SoE tables
soe_sch_ta1_pl_eff<-read_xlsx("data/soe_tables_2024.01.26.xlsx", sheet = 1)
soe_sch_ta1_apd_eff<-read_xlsx("data/soe_tables_2024.01.26.xlsx", sheet = 2)
soe_pd_ta1_pl_eff<-read_xlsx("data/soe_tables_2024.01.26.xlsx", sheet = 3)
soe_all_ta1_pl_saf<-read_xlsx("data/soe_tables_2024.01.26.xlsx", sheet = 4)
soe_all_ta1_apd_saf<-read_xlsx("data/soe_tables_2024.01.26.xlsx", sheet = 5)
soe_mechanistic<-read_xlsx("data/soe_tables_2024.01.26.xlsx", sheet = 6)
#Round off results to two digits
options(scipen=1, digits=2)
forest(meta_comp_overall_sch,
col.diamond = "royalblue4",
col.square =   "royalblue1",
rightcols = c("effect", "ci","Overall"),
rightlabs = c("SMD", "95%-CI", "Risk of bias"),
xlim=c(-0.8,0.8),
label.e = unique(meta_comp_overall_sch$data$treat1_new),
label.c=unique(meta_comp_overall_sch$data$treat2_new),
subgroup.hetstat = FALSE, overall.hetstat =TRUE, test.subgroup.random = FALSE,test.subgroup.fixed = FALSE,
overall = TRUE, prediction.subgroup = FALSE,
subgroup = FALSE, fixed=TRUE,
label.left = "Placebo better", label.right="TAAR1 better")
forest(meta_comp_overall_sch,
col.diamond = "royalblue4",
col.square =   "royalblue1",
rightcols = c("effect", "ci","Overall_overall"),
rightlabs = c("SMD", "95%-CI", "Risk of bias"),
xlim=c(-0.8,0.8),
label.e = unique(meta_comp_overall_sch$data$treat1_new),
label.c=unique(meta_comp_overall_sch$data$treat2_new),
subgroup.hetstat = FALSE, overall.hetstat =TRUE, test.subgroup.random = FALSE,test.subgroup.fixed = FALSE,
overall = TRUE, prediction.subgroup = FALSE,
subgroup = FALSE, fixed=TRUE,
label.left = "Placebo better", label.right="TAAR1 better")
pairwise_separate<-pairwise_separate %>% left_join(rob_overall) %>% left_join(rob_positive) %>% left_join(rob_resopnse)
meta_comp_overall_sch<-metacont(data=pairwise_separate[pairwise_separate$population=="Schizophrenia spectrum",],
mean.e = overall_mean1_new, sd.e=overall_sd1_new, n.e=overall_n1_new, mean.c = overall_mean2_new, sd.c=overall_sd2_new, n.c=overall_n2_new,
sm="SMD", random=TRUE, fixed=TRUE,
studlab = study_name_drug, prediction = FALSE, subgroup = population,
prediction.subgroup = FALSE)
meta_comp_overall_pdp<-metacont(data=pairwise_separate[pairwise_separate$population=="Parkinson Disease Psychosis",],
mean.e = overall_mean1_new, sd.e=overall_sd1_new, n.e=overall_n1_new, mean.c = overall_mean2_new, sd.c=overall_sd2_new, n.c=overall_n2_new,
sm="SMD", random=TRUE, fixed=TRUE,
studlab = study_name_drug, prediction = FALSE, subgroup = population,
prediction.subgroup = FALSE)
meta_comp_positive_sch<-metacont(data=pairwise_separate[pairwise_separate$population=="Schizophrenia spectrum" & !is.na(pairwise_separate$positive_mean1_new),],
mean.e = positive_mean1_new, sd.e=positive_sd1_new, n.e=positive_n1_new, mean.c = positive_mean2_new, sd.c=positive_sd2_new, n.c=positive_n2_new,
sm="SMD", random=TRUE, fixed=TRUE,
studlab = study_name_drug, prediction = FALSE, subgroup = population,
prediction.subgroup = FALSE)
meta_comp_positive_pdp<-metacont(data=pairwise_separate[pairwise_separate$population=="Parkinson Disease Psychosis",],
mean.e = positive_mean1_new, sd.e=positive_sd1_new, n.e=positive_n1_new, mean.c = positive_mean2_new, sd.c=positive_sd2_new, n.c=positive_n2_new,
sm="SMD", random=TRUE, fixed=TRUE,
studlab = study_name_drug, prediction = FALSE, subgroup = population,
prediction.subgroup = FALSE)
meta_comp_response_sch<-metabin(data=pairwise_separate[pairwise_separate$population=="Schizophrenia spectrum",],
event.e = response1, n.e=random1, event.c = response2, n.c=random2,
sm="OR", random=TRUE, fixed=TRUE,
studlab = study_name_drug, prediction = FALSE, subgroup = population,
prediction.subgroup = FALSE)
meta_comp_response_pdp<-metabin(data=pairwise_separate[pairwise_separate$population=="Parkinson Disease Psychosis",],
event.e = response1, n.e=random1, event.c = response2, n.c=random2,
sm="OR", random=TRUE, fixed=TRUE,
studlab = study_name_drug, prediction = FALSE, subgroup = population,
prediction.subgroup = FALSE)
forest(meta_comp_overall_sch,
col.diamond = "royalblue4",
col.square =   "royalblue1",
rightcols = c("effect", "ci","Overall_overall"),
rightlabs = c("SMD", "95%-CI", "Risk of bias"),
xlim=c(-0.8,0.8),
label.e = unique(meta_comp_overall_sch$data$treat1_new),
label.c=unique(meta_comp_overall_sch$data$treat2_new),
subgroup.hetstat = FALSE, overall.hetstat =TRUE, test.subgroup.random = FALSE,test.subgroup.fixed = FALSE,
overall = TRUE, prediction.subgroup = FALSE,
subgroup = FALSE, fixed=TRUE,
label.left = "Placebo better", label.right="TAAR1 better")
forest(meta_comp_overall_pdp,
col.diamond = "royalblue4",
col.square =   "royalblue1",
rightcols = c("effect", "ci","Overall_overall"),
rightlabs = c("SMD", "95%-CI", "Risk of bias"),
xlim=c(-0.8,0.8),
label.e = unique(meta_comp_overall_pdp$data$treat1_new),
label.c=unique(meta_comp_overall_pdp$data$treat2_new),
subgroup.hetstat = FALSE, overall.hetstat =TRUE, test.subgroup.random = FALSE,test.subgroup.fixed = FALSE,
overall = TRUE, prediction.subgroup = FALSE,
subgroup = FALSE, fixed=TRUE,
label.left = "Placebo better", label.right="TAAR1 better")
forest(meta_comp_overall_pdp,
col.diamond = "royalblue4",
col.square =   "royalblue1",
rightcols = c("effect", "ci","Overall_overall"),
rightlabs = c("SMD", "95%-CI", "Risk of bias"),
xlim=c(-0.8,0.8),
label.e = unique(meta_comp_overall_pdp$data$treat1_new),
label.c=unique(meta_comp_overall_pdp$data$treat2_new),
subgroup.hetstat = FALSE, overall.hetstat =FALSE, test.subgroup.random = FALSE,test.subgroup.fixed = FALSE,
overall = TRUE, prediction.subgroup = FALSE,
subgroup = FALSE, fixed=TRUE,
label.left = "Placebo better", label.right="TAAR1 better")
forest(meta_comp_overall_pdp,
col.diamond = "royalblue4",
col.square =   "royalblue1",
rightcols = c("effect", "ci","Overall_overall"),
rightlabs = c("SMD", "95%-CI", "Risk of bias"),
xlim=c(-0.8,0.8),
label.e = unique(meta_comp_overall_pdp$data$treat1_new),
label.c=unique(meta_comp_overall_pdp$data$treat2_new),
subgroup.hetstat = FALSE, overall.hetstat =FALSE, test.subgroup.random = FALSE,test.subgroup.fixed = FALSE,
overall = FALSE, prediction.subgroup = FALSE,
subgroup = FALSE, fixed=TRUE,
label.left = "Placebo better", label.right="TAAR1 better")
forest(meta_comp_positive_pdp,
col.diamond = "royalblue4",
col.square =   "royalblue1",
rightcols = c("effect", "ci", "Overall"),
rightlabs = c("SMD", "95%-CI", "Risk of bias"),  xlim=c(-0.8,0.8),
label.e = unique(meta_comp_positive_pdp$data$treat1_new),
label.c=unique(meta_comp_positive_pdp$data$treat2_new),
subgroup.hetstat = TRUE, overall.hetstat =FALSE, test.subgroup.random = FALSE,test.subgroup.fixed = FALSE,
overall = FALSE, prediction.subgroup = FALSE,
subgroup = TRUE, fixed=TRUE,
label.left = "Placebo better", label.right="TAAR1 better")
forest(meta_comp_positive_pdp,
col.diamond = "royalblue4",
col.square =   "royalblue1",
rightcols = c("effect", "ci", "Overall_positive"),
rightlabs = c("SMD", "95%-CI", "Risk of bias"),  xlim=c(-0.8,0.8),
label.e = unique(meta_comp_positive_pdp$data$treat1_new),
label.c=unique(meta_comp_positive_pdp$data$treat2_new),
subgroup.hetstat = TRUE, overall.hetstat =FALSE, test.subgroup.random = FALSE,test.subgroup.fixed = FALSE,
overall = FALSE, prediction.subgroup = FALSE,
subgroup = TRUE, fixed=TRUE,
label.left = "Placebo better", label.right="TAAR1 better")
forest(meta_comp_positive_sch,
col.diamond = "royalblue4",
col.square =   "royalblue1",
rightcols = c("effect", "ci", "Overall_positive"),
rightlabs = c("SMD", "95%-CI", "Risk of bias"),  xlim=c(-0.8,0.8),
label.e = unique(meta_comp_positive_sch$data$treat1_new),
label.c=unique(meta_comp_positive_sch$data$treat2_new),
subgroup.hetstat = TRUE, overall.hetstat =FALSE, test.subgroup.random = FALSE,test.subgroup.fixed = FALSE,
overall = FALSE, prediction.subgroup = FALSE,
subgroup = TRUE, fixed=TRUE,
label.left = "Placebo better", label.right="TAAR1 better")
forest(`meta_comp_taar1_vs_placebo_3-13 weeks_depression`,
col.diamond = "royalblue4",
col.square =   "royalblue1",
rightcols = c("effect", "ci", "Overall"),
rightlabs = c("SMD", "95%-CI", "Risk of bias"),  xlim=c(-0.5,0.5),
label.e = unique(`meta_comp_taar1_vs_placebo_3-13 weeks_depression`$data$treat1_new),  label.c=unique(`meta_comp_taar1_vs_placebo_3-13 weeks_depression`$data$treat2_new),
subgroup.hetstat = TRUE, overall.hetstat =FALSE, test.subgroup.random = FALSE,test.subgroup.fixed = FALSE,
overall = FALSE, prediction.subgroup = FALSE,
subgroup = TRUE, fixed=TRUE,
label.left = "Placebo better", label.right="TAAR1 better")
forest(`meta_comp_taar1_vs_placebo_3-13 weeks_cognition`,
col.diamond = "royalblue4",
col.square =   "royalblue1",
rightcols = c("effect", "ci", "Overall"),
rightlabs = c("SMD", "95%-CI", "Risk of bias"),  xlim=c(-0.8,0.8),
label.e = unique(`meta_comp_taar1_vs_placebo_3-13 weeks_cognition`$data$treat1_new),  label.c=unique(`meta_comp_taar1_vs_placebo_3-13 weeks_cognition`$data$treat2_new),
subgroup.hetstat = TRUE, overall.hetstat =FALSE, test.subgroup.random = FALSE,test.subgroup.fixed = FALSE,
overall = FALSE, prediction.subgroup = FALSE,
subgroup = TRUE, fixed=TRUE,
label.left = "Placebo better", label.right="TAAR1 better")
forest(meta_comp_response_pdp,
col.diamond = "royalblue4",
col.square =   "royalblue1",
rightcols = c("effect", "ci", "Overall_response"),
rightlabs = c("OR", "95%-CI", "Risk of bias"),  xlim=c(0.2,5),
label.e = unique(meta_comp_response_pdp$data$treat1_new),
label.c="placebo",
subgroup.hetstat = TRUE, overall.hetstat =FALSE, test.subgroup.random = FALSE,test.subgroup.fixed = FALSE,
overall = FALSE, prediction.subgroup = FALSE,
subgroup = TRUE, fixed=TRUE,
label.left = "Placebo better", label.right="TAAR1 better")
forest(meta_comp_response_sch,
col.diamond = "royalblue4",
col.square =   "royalblue1",
rightcols = c("effect", "ci", "Overall_response"),
rightlabs = c("OR", "95%-CI", "Risk of bias"),  xlim=c(0.2,5),
label.e = unique(meta_comp_response_sch$data$treat1_new),
label.c="placebo",
subgroup.hetstat = TRUE, overall.hetstat =FALSE, test.subgroup.random = FALSE,test.subgroup.fixed = FALSE,
overall = FALSE, prediction.subgroup = FALSE,
subgroup = TRUE, fixed=TRUE,
label.left = "Placebo better", label.right="TAAR1 better")
forest(`meta_comp_taar1_vs_antipsychotic_3-13 weeks_response`,
col.diamond = "royalblue4",
col.square =   "royalblue1",
rightcols = c("effect", "ci","Overall"),
rightlabs = c("OR", "95%-CI", "Risk of bias"),
xlim=c(0.2,5),
label.c="risperidone",
label.e = unique(`meta_comp_taar1_vs_antipsychotic_3-13 weeks_response`$data$treat1_new),
subgroup.hetstat = TRUE, overall.hetstat =FALSE, test.subgroup.random = FALSE,test.subgroup.fixed = FALSE,
overall = FALSE, prediction.subgroup = FALSE,
subgroup = TRUE, fixed=TRUE,
label.left = "Antipsychotic better", label.right="TAAR1 better")
outcome_categories<-outcome_names %>%
select(outcome, event_text)
efficacy_primary<-meta_outcome %>% left_join(outcome_categories) %>%
filter(outcome=="cognition" | outcome=="depression" | outcome=="negative" | outcome=="overall" | outcome=="positive") %>% #efficacy outcome
filter(!is.na(TE.random)) %>% filter(!is.na(event_text)) %>%
mutate(point=TE.random,
lb=TE.random-1.96*seTE.random,
ub=TE.random+1.96*seTE.random) %>%
unique() %>%
filter(comparison=="taar1_vs_placebo")
efficacy_primary$population <- factor(efficacy_primary$population, levels=unique(efficacy_primary$population))
efficacy_primary$event_text <- factor(efficacy_primary$event_tex, levels=unique(efficacy_primary$event_tex))
level_outcomes<- c("Overall symptoms", "Positive symptoms", "Negative symptoms", "Depressive symptoms", "Cognitive impairement")
level_population<-c("Schizophrenia spectrum", "Parkinson Disease Psychosis")
ggplot(data=efficacy_primary,
aes(y=factor(event_text, level=rev(level_outcomes)), x=point))+
geom_point(aes(size=n), position=position_dodge(width = 0.5), colour="royalblue4")+ #Size proportional to the number of participants
coord_cartesian(xlim=c(-0.8,0.8))+
geom_errorbar(aes(x=point, xmin=lb,
xmax=ub),
width=0, position=position_dodge(width = 0.5), colour="royalblue4")+
scale_size_continuous(guide=FALSE)+
geom_vline(xintercept=0, linetype='dashed')+
facet_grid(~factor(population, levels=level_population))+
ylab("")+
xlab("SMD 95%CI (SMD>0: TAAR1 agonist better)")+
theme_bw()
rob_traffic_light(rob_all, tool="Generic")
knitr::kable(soe_pdp_ta1_pl_eff)
soe_pd_ta1_pl_eff
knitr::kable(soe_pd_ta1_pl_eff)
knitr::kable(soe_pd_ta1_pl_eff)
knitr::kable(soe_mechanistic)
#SoE tables
soe_sch_ta1_pl_eff<-read_xlsx("data/soe_tables_2024.01.29.xlsx", sheet = 1)
soe_sch_ta1_apd_eff<-read_xlsx("data/soe_tables_2024.01.29.xlsx", sheet = 2)
soe_pd_ta1_pl_eff<-read_xlsx("data/soe_tables_2024.01.29.xlsx", sheet = 3)
soe_all_ta1_pl_saf<-read_xlsx("data/soe_tables_2024.01.29.xlsx", sheet = 4)
soe_all_ta1_apd_saf<-read_xlsx("data/soe_tables_2024.01.29.xlsx", sheet = 5)
soe_mechanistic<-read_xlsx("data/soe_tables_2024.01.29.xlsx", sheet = 6)
knitr::kable(soe_sch_ta1_apd_eff)
knitr::kable(soe_all_ta1_apd_saf)
